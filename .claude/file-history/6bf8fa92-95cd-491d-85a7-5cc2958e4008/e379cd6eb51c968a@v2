---
phase: 03-interface-cleanup-cutover
plan: 03
subsystem: integration
tags: [signal-pipeline, cli, websocket, cutover, gradual-replacement]

# Dependency graph
requires:
  - phase: 03-02
    provides: SignalProcessor with sub-100ms performance
  - phase: 02-03
    provides: createSignalPipeline integration helper
provides:
  - Signal pipeline wired into CLI run command
  - --new-engine flag for gradual cutover
  - Parallel mode for validation during transition
  - close_position and close_all_positions WebSocket commands
  - CVD (Cumulative Volume Delta) data feed endpoint
affects: [frontend, lois-integration]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Gradual cutover with parallel mode
    - Feature flag for engine switching

key-files:
  created: []
  modified:
    - src/cli.ts
    - src/websocket-server.ts
    - src/signal/integration.ts

key-decisions:
  - "Parallel mode as default - both engines run for validation"
  - "--new-engine flag switches to new pipeline only"
  - "Old code preserved until validation complete"

patterns-established:
  - "Feature flag pattern for gradual replacement"
  - "Signal callback broadcasting via WebSocket"

issues-created: []

# Metrics
duration: 9min
completed: 2026-01-09
---

# Phase 3 Plan 3: Final Cutover Summary

**Signal pipeline integrated into CLI with --new-engine flag enabling gradual cutover from polling to reactive signal processing**

## Performance

- **Duration:** 20 min
- **Started:** 2026-01-09T07:16:22Z
- **Completed:** 2026-01-09T07:36:00Z
- **Tasks:** 2 auto + 1 checkpoint + 2 additional features
- **Files modified:** 3

## Accomplishments
- Signal pipeline wired into CLI run command with market data provider
- `--new-engine` flag enables switching between parallel and new-only modes
- Signal callback broadcasts rule signals via WebSocket
- Data feed handler routes incoming messages through SignalProcessor
- `close_position` and `close_all_positions` WebSocket commands for frontend control
- CVD (Cumulative Volume Delta) data feed endpoint for volume analysis

## Task Commits

Each task was committed atomically:

1. **Task 1: Integrate signal pipeline into CLI run command** - `c2190d7` (feat)
2. **Task 2: Add parallel mode flag for gradual cutover** - `063ebc7` (feat)
3. **Additional: close_position and close_all_positions commands** - `ddc88d3` (feat)
4. **Additional: CVD data feed endpoint** - `4bffc18` (feat)

**Plan metadata:** `062dafe` (docs: complete plan)

## Files Created/Modified
- `src/cli.ts` - Signal pipeline integration, --new-engine flag, close position handlers
- `src/websocket-server.ts` - CVDData interface, close position command types, CVD storage
- `src/signal/integration.ts` - CVD update routing in data feed handler

## Decisions Made
- Parallel mode as default for safe validation during transition
- `--new-engine` flag enables new pipeline only when ready
- Old polling code preserved (not deleted) until validation complete

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
- Port 8765 conflict when frontend runs its own WebSocket server instance
- Resolution: Frontend needs to connect to backend's WebSocket instead of starting its own

## Next Phase Readiness
- Phase 3 COMPLETE - all plans finished
- Milestone complete - ready for production validation
- Frontend integration needed: connect to backend WebSocket instead of spawning own instance

## Frontend Integration Note

The frontend currently starts its own WebSocket server on port 8765, causing conflicts. The frontend should:
1. Remove its embedded WebSocket server startup
2. Connect as a client to the backend's WebSocket at ws://localhost:8765
3. Receive signals via the `signal` event type

---
*Phase: 03-interface-cleanup-cutover*
*Completed: 2026-01-09*
