---
phase: 22-watchlist-style-screener-volume-trends
plan: 02
type: execute
---

<objective>
Replace current TokenRow/TokenListColumn with TanStack React Table layout matching Watchlist widget styling.

Purpose: Adopt production Watchlist widget's table layout for screener columns - compact, branded, professional.
Output: Three screener columns using table layout with Symbol, MCap, Price Change columns, plus token management controls.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/22-watchlist-style-screener-volume-trends/22-01-SUMMARY.md

# Watchlist widget reference (pattern to follow)

@apps/web-terminal/src/ui/dashboard/widgets/watchlist-widget-table-view.tsx

# Shared cell components to reuse

@apps/web-terminal/src/ui/discovery/lists/shared/cells/symbol-cell.tsx
@apps/web-terminal/src/ui/discovery/lists/shared/cells/mcap-cell.tsx
@apps/web-terminal/src/ui/discovery/lists/shared/cells/price-change-cell.tsx

# Current screener implementation to replace

@apps/web-terminal/src/ui/dashboard/widgets/autopilot-widget.tsx

# Token management patterns

@apps/web-terminal/src/components/watchlist-toggle/watchlist-toggle.tsx
@apps/web-terminal/src/pages/XRayPage/XRayTokensList/XRayListItem/XRayListItem.tsx (hideToken pattern)

# Blacklist store for hide functionality

# Uses: usePersistentGlobalStore -> state.blacklist.addToBlacklist/isBlacklisted

# Prior decisions

- Row height: TABLE_ROW_HEIGHT_SMALL + 8 (44px)
- Keep signal backgrounds (confluence-based from Phase 17)
- Font sizes must remain same as Watchlist widget
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create ScreenerTable component</name>
  <files>apps/web-terminal/src/ui/dashboard/widgets/autopilot-widget/screener-table.tsx</files>
  <action>
    Create a new ScreenerTable component based on Watchlist widget table pattern:

    1. Use @tanstack/react-table with createColumnHelper<ScreenerTokenData>()
    2. Configure columns:
       - **Token** (Symbol): 100px width, use SymbolCell pattern (image + symbol text)
       - **MCap**: 70px width, formatted USD (K/M suffixes)
       - **1h %**: 60px width, use PriceChangeCell pattern (green/red)
       - **Action**: 32px width - WatchlistToggle OR HideButton based on column type

    3. Row styling:
       - Height: 44px (TABLE_ROW_HEIGHT_SMALL + 8)
       - Background: signal-based (keep confluence coloring from Phase 17)
       - Hover: `hover:bg-bg-quartiary`
       - Clickable: navigate to `/trading/${mint}`
       - Rounded corners on first/last cells

    4. Props interface:
       ```typescript
       type ScreenerTableProps = {
         tokens: ScreenerTokenData[];
         columnType: 'watchlist' | 'trending' | 'whales';
         signalStrengthMap: Map<string, SignalStrength>;
         onHideToken?: (mint: string) => void;
       };
       ```

    Follow watchlist-widget-table-view.tsx patterns exactly for table setup.
    Do NOT include Volume or Liquidity columns (removed per requirements).

  </action>
  <verify>TypeScript compiles, component renders without errors</verify>
  <done>ScreenerTable component created with columns matching Watchlist style</done>
</task>

<task type="auto">
  <name>Task 2: Create HideTokenButton component</name>
  <files>apps/web-terminal/src/ui/dashboard/widgets/autopilot-widget/hide-token-button.tsx</files>
  <action>
    Create a HideTokenButton component following X-Ray's pattern:

    1. Use `usePersistentGlobalStore` blacklist functions:
       - `state.blacklist.addToBlacklist(mint)`
       - `state.blacklist.isBlacklisted(mint)`

    2. UI: Small X or EyeOff icon button (similar to WatchlistToggle size)
       - Icon: Use `X` from lucide-react (or `EyeOff` if X looks too aggressive)
       - Size: `size-4` to match WatchlistToggle
       - Tooltip: "Hide token" / "Unhide token"

    3. onClick handler:
       - Prevent event propagation (don't navigate)
       - Toggle blacklist state
       - Show toast confirmation

    4. Props:
       ```typescript
       type HideTokenButtonProps = {
         mint: string;
         symbol: string;
       };
       ```

    Note: Hidden tokens view is deferred to future phase.

  </action>
  <verify>Component renders, click toggles blacklist state</verify>
  <done>HideTokenButton created following X-Ray blacklist pattern</done>
</task>

<task type="auto">
  <name>Task 3: Replace TokenListColumn with ScreenerTable</name>
  <files>apps/web-terminal/src/ui/dashboard/widgets/autopilot-widget.tsx</files>
  <action>
    Update the Screener section to use new ScreenerTable:

    1. Replace the three TokenListColumn usages with ScreenerTable:
       ```tsx
       <ScreenerTable
         tokens={watchlistTokens}
         columnType="watchlist"
         signalStrengthMap={signalStrengthMap}
       />
       ```

    2. For Watchlist column: action column shows WatchlistToggle
    3. For Trending/Whales columns: action column shows HideTokenButton

    4. Filter out blacklisted tokens from trending/whales:
       ```typescript
       const visibleTrendingTokens = trendingTokens.filter(
         t => !isBlacklisted(t.mint)
       );
       ```

    5. Keep existing column headers (Eye/Flame/Wallet icons with counts)

    6. Remove old TokenRow and TokenListColumn components (or keep temporarily for reference)

    Preserve the three-column grid layout:
    ```tsx
    <div className="grid min-h-0 flex-1 grid-cols-3 gap-2 overflow-hidden">
    ```

  </action>
  <verify>`npm run dev` - screener displays with new table layout</verify>
  <done>Screener uses ScreenerTable for all three columns</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Watchlist-style table layout for screener columns with token management controls</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Open Autopilot widget in dashboard
    3. Verify screener columns show table layout:
       - Token (image + symbol)
       - MCap (formatted)
       - 1h % change (colored)
       - Action button (star for Watchlist, X for Trending/Whales)
    4. Verify row height matches Watchlist widget (compact, ~44px)
    5. Verify signal backgrounds still work (green/red based on confluence)
    6. Click star in Watchlist column - should toggle watchlist
    7. Click X in Trending/Whales - should hide token from list
    8. Click token row - should navigate to trading page
    9. Check font sizes match Watchlist widget (brand consistency)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` passes
- [ ] `npm run dev` shows screener with table layout
- [ ] All three columns display correctly
- [ ] Token management controls work (star, hide)
- [ ] Signal backgrounds preserved
- [ ] Row click navigation works
</verification>

<success_criteria>

- ScreenerTable component created matching Watchlist widget style
- HideTokenButton component created with blacklist integration
- All three screener columns use new table layout
- Watchlist has star toggle, Trending/Whales have hide button
- Visual appearance matches Watchlist widget (compact, branded)
- Human verified the visual result
  </success_criteria>

<output>
After completion, create `.planning/phases/22-watchlist-style-screener-volume-trends/22-02-SUMMARY.md`
</output>
