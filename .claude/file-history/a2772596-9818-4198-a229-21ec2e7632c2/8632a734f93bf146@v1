---
phase: 20-controls-accuracy
plan: 01
subsystem: ui
tags: [websocket, commands, position-management, react]

# Dependency graph
requires:
  - phase: 22-watchlist-screener
    provides: Volume trend indicator, screener table layout
provides:
  - close_all_positions command wiring
  - close_position command with mint parameter
  - Per-position X button in PositionCard
affects: [21-aat-naming]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Per-position close callback pattern

key-files:
  created: []
  modified:
    - apps/web-terminal/src/websocket/autopilot/AutopilotWebsocket.ts
    - apps/web-terminal/src/ui/dashboard/widgets/autopilot-widget.tsx

key-decisions:
  - "X button positioned after P&L display for visual balance"

patterns-established:
  - "onClose callback pattern for per-item actions in list components"

issues-created: []

# Metrics
duration: 2min
completed: 2026-01-09
---

# Phase 20 Plan 01: Frontend Close Controls Summary

**Wired frontend close commands (close_all_positions, close_position) and added X button to each PositionCard**

## Performance

- **Duration:** 2 min
- **Started:** 2026-01-09T07:06:06Z
- **Completed:** 2026-01-09T07:08:35Z
- **Tasks:** 1
- **Files modified:** 2

## Accomplishments

- Updated AutopilotCommand type to use correct command names matching backend
- Added `onClose` prop to PositionCard component
- Added X button to each position card for closing individual positions
- Close All button now sends `close_all_positions` instead of `close_all`

## Task Commits

1. **Task 1: Wire up close commands and add per-position close button** - `10efa5091` (feat)

**Plan metadata:** TBD (docs: complete plan)

## Files Created/Modified

- `apps/web-terminal/src/websocket/autopilot/AutopilotWebsocket.ts` - Updated AutopilotCommand type with close_all_positions and close_position
- `apps/web-terminal/src/ui/dashboard/widgets/autopilot-widget.tsx` - Added onClose prop, X button to PositionCard, updated Close All handler

## Decisions Made

- X button positioned after the P&L display (right side of card) for visual balance and intuitive placement

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

- Pre-existing TypeScript errors in `packages/pvp/` unrelated to this feature (not caused by these changes)

## Next Phase Readiness

- Phase 20 complete
- Ready for Phase 21 (AAT Naming) - final phase in v1.5 milestone

---
*Phase: 20-controls-accuracy*
*Completed: 2026-01-09*
