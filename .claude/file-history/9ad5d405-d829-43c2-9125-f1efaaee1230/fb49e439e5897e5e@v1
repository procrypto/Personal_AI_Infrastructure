---
phase: 13-layout-clarity
plan: 01
subsystem: ui
tags: [layout, ux, tooltips, three-column, performance-stats]

# Dependency graph
requires:
  - phase: 12-data-flow-debugging
    provides: Fixed NATS market data parsing and SOL price derivation
provides:
  - Open positions in dedicated top section
  - Three-column token layout (Watchlist, Trending, Whales)
  - Tooltips on header elements for clarity
  - Unrealized/Realized P&L in stats panel
  - Close All button in performance section
  - Solana logo icon in header
affects: [14-controls-formatting]

# Tech tracking
tech-stack:
  added: []
  patterns: [formatTokenPrice helper, sticky token sorting]

key-files:
  created: []
  modified:
    - apps/web-terminal/src/ui/dashboard/widgets/autopilot-widget.tsx

key-decisions:
  - "Show both Realized and Unrealized P&L in stats grid (5 columns)"
  - "Realized = totalPnlSol - unrealizedPnlSol (actual closed trade profit)"
  - "Token prices: 2 decimals for >= $0.01, more for smaller prices"
  - "Open position tokens sorted to top of their lists (sticky)"
  - "Close All button always visible, disabled when no positions"

patterns-established:
  - "formatTokenPrice() for consistent USD price formatting"
  - "useMemo for token sorting with hasPosition priority"

issues-created: []

# Metrics
duration: 48min
completed: 2026-01-09
---

# Phase 13 Plan 01: Layout & Clarity Summary

**Widget layout reorganized with three-column tokens, dedicated positions section, performance stats with realized/unrealized P&L, and close all button**

## Performance

- **Duration:** 48 min
- **Started:** 2026-01-08T23:29:17Z
- **Completed:** 2026-01-09T00:18:12Z
- **Tasks:** 4 planned + multiple checkpoint refinements
- **Files modified:** 1

## Accomplishments

- Open positions moved to dedicated section above Performance
- Three-column token layout showing Watchlist, Trending, Whales simultaneously
- Tooltips added to scan counter, rules matched indicator
- Stats panel shows 5 metrics: Trades, Win Rate, Record, Realized, Unrealized
- Close All button added to performance section
- Solana logo icon replaces "SOL" text in header
- Token prices formatted without scientific notation
- Open position tokens sticky at top of their lists

## Task Commits

1. **Task 1: Move positions to top** - `d3005174b` (feat)
2. **Task 2: Add header tooltips** - `97621a45d` (feat)
3. **Task 3: Clarify activity numbers** - `d726184dc` (feat)
4. **Task 4: Three-column tokens** - `b33a38185` (feat)
5. **Checkpoint refinements** - `615d9955c` (feat) - Solana icon, price formatting, sticky tokens
6. **Stats panel refinements** - `6c5753724` (fix) - P&L in grid, 2 decimal prices
7. **Price formatting fix** - `34a498793` (fix) - Appropriate decimals for small prices
8. **Always show unrealized** - `c13ef1a14` (fix) - 5-column grid always
9. **Market status cleanup** - `e4d5c9bdc` (fix) - Remove border/background
10. **Realized profit fix** - `4dd76059d` (fix) - Show actual realized vs lifetime
11. **Close all button** - `be75a9c19` (feat) - Add to performance section
12. **Button polish** - `53b44a8b9` (fix) - Remove tooltip, fix centering

## Files Created/Modified

- `apps/web-terminal/src/ui/dashboard/widgets/autopilot-widget.tsx` - Layout reorganization, new components, stats panel updates

## Decisions Made

- **Realized vs Lifetime P&L**: Calculate realized as `totalPnlSol - unrealizedPnlSol` to show only closed trade profit
- **Always show Unrealized**: Display 5-column stats grid even with no positions (shows +0.0000)
- **Token price formatting**: Adaptive decimals (2 for >= $0.01, 4/6/8 for smaller)
- **Close All placement**: In performance section, always visible but disabled when no positions
- **Market status badge**: No border/background, just colored text with icon

## Deviations from Plan

### Checkpoint Refinements

Multiple iterations based on user feedback during checkpoint verification:
- Moved unrealized P&L from header to stats grid
- Added Solana logo icon
- Fixed token price formatting
- Made open tokens sticky
- Added close all button
- Adjusted realized P&L calculation

**Impact on plan:** Extended duration from ~10min to 48min due to iterative refinements. All refinements improved UX.

## Issues Encountered

None - all checkpoint feedback was addressed inline.

## Next Phase Readiness

- Layout and clarity improvements complete
- Ready for Phase 14: Controls & Formatting
- Close All button wired to `close_all` command

---
*Phase: 13-layout-clarity*
*Completed: 2026-01-09*
