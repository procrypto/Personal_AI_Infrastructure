# Milestone v1.4: Widget Polish & Data Fixes

**Status:** SHIPPED 2026-01-09
**Phases:** 12-17
**Total Plans:** 6

## Overview

Fix data flow issues, improve layout clarity, add trading controls, integrate Discovery API for fast data loading, and add visual signal indicators.

## Phases

### Phase 12: Data Flow Debugging

**Goal:** Fix NATS market data for tokens and positions
**Plans:** 1 plan

- [x] 12-01: Debug and fix NATS market data enrichment

**Key accomplishments:**

- Fixed token price enrichment by parsing `price_sol` as string (NATS sends strings)
- Added SOL/USD price derivation from market data as fallback
- Updated MarketStatusBadge display format

### Phase 13: Layout & Clarity

**Goal:** Three-column tokens, reorder sections, clarify labels
**Plans:** 1 plan

- [x] 13-01: Layout reorganization with three-column tokens

**Key accomplishments:**

- Three-column token layout (Watchlist, Trending, Whales)
- Stats panel with 5 metrics: Trades, Win Rate, Record, Realized, Unrealized
- Close All button in performance section
- Token prices formatted without scientific notation
- Open position tokens sticky at top of lists

### Phase 14: Controls & Formatting

**Goal:** Draggable SettingsPanel, header controls, renamed to Screener
**Plans:** 1 plan

- [x] 14-01: Add floating SettingsPanel with header controls

**Key accomplishments:**

- PAPER/LIVE mode badge and Live Trading toggle in header
- Draggable floating SettingsPanel (vantage-widget pattern)
- Removed old Configuration section
- Renamed "Tokens" section to "Screener"

### Phase 15: Discovery API Integration

**Goal:** Frontend uses Discovery API/WebSocket for whale moves and trending
**Plans:** 1 plan

- [x] 15-01: Integrate Discovery sources for instant data

**Key accomplishments:**

- Created `useAutopilotDiscoveryTokens` hook for hybrid data sourcing
- Whale moves from Discovery API (1s refresh)
- Trending from Discovery WebSocket store (instant)

### Phase 16: User Watchlist Integration

**Goal:** Replace CLI-derived watchlist with user's watchlist
**Plans:** 1 plan

- [x] 16-01: Integrate user watchlist API

**Key accomplishments:**

- User's starred tokens appear in Screener watchlist column
- NATS market_data subscriptions for user watchlist mints
- Seamless integration with existing Discovery sources

### Phase 17: Screener Signal Indicators

**Goal:** Confluence-based signal indicators on token rows
**Plans:** 1 plan

- [x] 17-01: Add visual signal indicators to token rows

**Key accomplishments:**

- Created `useTokenSignalStrength` hook with confluence counting
- Removed Activity section (signals now inline)
- Background color intensity based on confluence count
- Sticky sorting (buy signals top, sell signals middle)
- 100ms flash effect on new signals

---

## Milestone Summary

**Key Decisions:**

- SOL price derived from market data (price_usd / price_sol) as fallback
- Realized P&L = totalPnlSol - unrealizedPnlSol
- Vantage-widget pattern for draggable floating panels
- Portal to document.body when panel dragged (escape overflow)
- Confluence-based signal intensity (not time decay)
- Brand palette backgrounds for signal highlighting

**Issues Resolved:**

- Token price changes showing 0.00% - Fixed string parsing
- Position cards showing "Loading" - Fixed market data subscription
- Layout clarity issues - Three-column layout, tooltips
- Missing "Close All Trades" button - Added to performance section

**Issues Deferred:**

- Backend Discovery WebSocket integration - Deferred to v2.0

**Technical Debt:**

- Debug panel in autopilot widget (remove before production)

---

_For current project status, see .planning/ROADMAP.md_
