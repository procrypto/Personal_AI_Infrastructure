/**
 * Configuration loaded from environment variables.
 *
 * ⚠️  These credentials connect to PRODUCTION ClickHouse.
 */

// Environment types
export type Environment = "local" | "beta" | "prod";

const getEnvironment = (): Environment => {
    const env = process.env.APP_ENV;
    if (env === "beta" || env === "prod") return env;
    return "local";
};

export const isLocal = (): boolean => getEnvironment() === "local";
export const isBeta = (): boolean => getEnvironment() === "beta";
export const isProd = (): boolean => getEnvironment() === "prod";

export const config = {
    clickhouse: {
        keyId: process.env.TBKM_CLICKHOUSE_KEY_ID ?? "",
        keySecret: process.env.TBKM_CLICKHOUSE_KEY_SECRET ?? "",
        serviceId: process.env.TBKM_CLICKHOUSE_SERVICE_ID ?? "",
    },
    port: Number(process.env.PORT) || 8787,
    enableExtensions: process.env.LOCAL_API_ENABLE_EXTENSIONS === "true",
};

export const assertConfig = () => {
    const missing: string[] = [];

    if (!config.clickhouse.keyId) missing.push("TBKM_CLICKHOUSE_KEY_ID");
    if (!config.clickhouse.keySecret) missing.push("TBKM_CLICKHOUSE_KEY_SECRET");
    if (!config.clickhouse.serviceId) missing.push("TBKM_CLICKHOUSE_SERVICE_ID");

    if (missing.length > 0) {
        console.error(`
╔══════════════════════════════════════════════════════════════════════════════╗
║  ❌ Missing ClickHouse credentials                                           ║
╚══════════════════════════════════════════════════════════════════════════════╝

Missing environment variables:
${missing.map(v => `  - ${v}`).join("\n")}

To fix:
  1. Copy env.example to .env:  cp env.example .env
  2. Fill in your credentials
  3. Restart the server

Get credentials from your team lead or TrenchBench WP admin settings.
`);
        process.exit(1);
    }
};





