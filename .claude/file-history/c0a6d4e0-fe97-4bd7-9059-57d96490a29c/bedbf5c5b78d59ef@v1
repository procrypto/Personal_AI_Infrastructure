export type Role = 'staff' | 'moderator' | '';

export interface UserMappingEntry {
    userId: string;
    preferredName: string;
    aliases: string[];
    role: Role;
}

export interface UserMapping {
    version: string;
    users: UserMappingEntry[];
}

export interface UserOption {
    userId: string;
    label: string;
    role: Role;
}

export interface TelegramMessage {
    id?: number | string;
    type?: string;
    date?: string;
    date_unixtime?: string;
    actor?: string;
    actor_id?: string;
    from?: string;
    from_id?: string;
    text?: string | unknown[];
    [key: string]: unknown;
}

export interface TelegramChat {
    name: string;
    type?: string;
    id: string | number;
    messages: TelegramMessage[];
    [key: string]: unknown;
}

export interface TelegramExport {
    list: TelegramChat[];
}

export interface DateRange {
    start?: Date;
    end?: Date;
}

export interface EnrichedMessage extends Record<string, unknown> {
    chatId: string;
    chatName: string;
}

export interface ChatOutput {
    chatId: string;
    chatName: string;
    chatType?: string;
    messages: EnrichedMessage[];
}

export interface WorkerProgress {
    phase: 'scan' | 'filter';
    loadedBytes: number;
    totalBytes: number;
    message?: string;
}

export interface UserInfo {
    userId: string;
    displayName: string;
    messageCount?: number; // Optional - not available in fast scan.
}

export interface GroupInfo {
    chatId: string;
    chatName: string;
    chatType?: string;
    messageCount?: number;
}

export interface WorkerScanResult {
    type: 'scanResult';
    users: UserInfo[];
    totalMessages: number;
    filteredMessages: number;
}

export interface WorkerFilterResult {
    type: 'filterResult';
    outputs: ChatOutput[];
    mapping: UserMapping;
    totalMessages: number;
}

export interface WorkerScanGroupResult {
    type: 'scanGroupResult';
    groups: GroupInfo[];
    totalMessages: number;
    filteredMessages: number;
    truncationContext?: string;
}

export interface WorkerReady {
    type: 'workerReady';
}

export type WorkerEvent = WorkerProgress | WorkerScanResult | WorkerFilterResult | WorkerScanGroupResult | WorkerReady;

// Topic Mode types

export interface IndexedChat {
    chatId: string;
    chatName: string;
    chatType?: string;
    messageCount: number;
    dateRange: { start: string | null; end: string | null };
    participants: string[]; // unique from_id values
    messages: EnrichedMessage[]; // full messages for search
}

export interface TopicIndex {
    chats: IndexedChat[];
    totalMessages: number;
    loadedAt: string;
}

