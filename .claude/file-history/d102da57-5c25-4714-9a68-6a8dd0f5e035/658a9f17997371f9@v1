# Codebase Structure

**Analysis Date:** 2026-01-09

## Directory Layout

```
token-analysis-autopilot/
├── src/                    # TypeScript source code
│   ├── api/               # External data integration
│   ├── config/            # Persistent configuration
│   ├── rules/             # Analysis rule system
│   ├── trading/           # Execution & position management
│   ├── cli.ts             # CLI interface + analysis loop
│   ├── websocket-server.ts # Frontend communication
│   ├── index.ts           # Demo entry point
│   └── test*.ts           # Test files
├── dist/                   # Compiled JavaScript output
├── .autopilot/            # Runtime config & data (gitignored)
├── package.json           # Project manifest
├── tsconfig.json          # TypeScript config
└── README.md              # Documentation
```

## Directory Purposes

**src/api/**
- Purpose: HTTP client for external market data
- Contains: ApiClient class, type definitions
- Key files: `client.ts` (186 lines), `types.ts`, `index.ts`
- Subdirectories: None

**src/config/**
- Purpose: Persistent user configuration
- Contains: JSON file I/O, config schema
- Key files: `store.ts`, `types.ts`, `index.ts`
- Subdirectories: None

**src/rules/**
- Purpose: Token analysis and signal generation
- Contains: Rule engine, rule implementations, templates
- Key files:
  - `engine.ts` - Orchestrates rule execution
  - `types.ts` - Interfaces and signal types
  - `templates.ts` - Pre-built strategy templates
  - `price-change.ts`, `volume-spike.ts`, `buy-sell-ratio.ts`, `trader-count.ts` - Rule implementations
  - `rotations.ts` - Market structure analysis
  - `dispatcher.ts`, `lois-types.ts` - LOIS integration types
- Subdirectories: None

**src/trading/**
- Purpose: Trade execution and position management
- Contains: Trigger, paper tracker, exit/entry logic
- Key files:
  - `trigger.ts` - Decision gate for trades
  - `paper-tracker.ts` - P&L calculation and history
  - `magic-exits.ts` - Structure-based exits (TP/SL/TSL)
  - `magic-buy.ts` - Auto-entry at support
  - `williams-tsl.ts` - Fractal trailing stop
  - `market-filter.ts` - SOL dump protection
  - `auto-sources.ts` - Trending/whale discovery
  - `types.ts` - Trading type definitions
- Subdirectories: None

## Key File Locations

**Entry Points:**
- `src/cli.ts` - Main CLI interface (41KB)
- `src/index.ts` - Demo entry point
- `src/websocket-server.ts` - WebSocket server (port 8765)

**Configuration:**
- `tsconfig.json` - TypeScript strict mode, ES2022
- `package.json` - Scripts, dependencies
- `.gitignore` - Excludes dist/, .autopilot/, node_modules/

**Core Logic:**
- `src/rules/engine.ts` - Rule orchestration
- `src/trading/trigger.ts` - Trade decision gate
- `src/api/client.ts` - Market data fetching

**Testing:**
- `src/test.ts` - Basic API and rule tests
- `src/test-trading.ts` - Trading feature tests
- `src/test-comprehensive.ts` - Full test suite
- `src/test-opposite.ts` - Opposite signal tests

**Documentation:**
- `README.md` - User-facing documentation

## Naming Conventions

**Files:**
- kebab-case.ts: All TypeScript files (e.g., `paper-tracker.ts`, `magic-exits.ts`)
- index.ts: Barrel exports for directories

**Directories:**
- Singular domain names: `api/`, `config/`
- Plural for collections: `rules/`, `trading/`

**Special Patterns:**
- test*.ts: Test files in src/ root
- *.d.ts: Type declaration files (in dist/)

## Where to Add New Code

**New Rule Type:**
- Implementation: `src/rules/{rule-name}.ts`
- Types: Add config to `src/rules/types.ts`
- Export: Add to `src/rules/index.ts`
- Templates: Add presets to `src/rules/templates.ts`

**New Trading Feature:**
- Implementation: `src/trading/{feature-name}.ts`
- Types: Add to `src/trading/types.ts`
- Export: Add to `src/trading/index.ts`
- Integration: Hook into `src/cli.ts` analysis loop

**New API Endpoint:**
- Add method to `src/api/client.ts`
- Add response type to `src/api/types.ts`

**New CLI Command:**
- Add to switch statement in `src/cli.ts` main()
- Follow existing pattern with help text

**New Config Option:**
- Add to UserConfig in `src/config/types.ts`
- Add default to DEFAULT_CONFIG
- Add getter/setter to `src/config/store.ts`

## Special Directories

**dist/**
- Purpose: Compiled JavaScript output
- Source: Generated by `npm run build`
- Committed: No (in .gitignore)

**.autopilot/**
- Purpose: Runtime config and data
- Contains: config.json, trades.json
- Committed: No (in .gitignore)

---

*Structure analysis: 2026-01-09*
*Update when directory structure changes*
