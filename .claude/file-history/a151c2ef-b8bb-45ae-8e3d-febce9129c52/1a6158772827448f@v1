---
phase: 04-auto-startup
plan: 01
type: execute
---

<objective>
Auto-start autopilot backend with frontend dev server and consolidate LOIS documentation.

Purpose: Improve DX by eliminating manual backend startup. Complete LOIS documentation for PUM3 team.
Output: Vite plugin that spawns autopilot backend, LOIS_INTEGRATION.md guide.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-backend-protocol/01-01-SUMMARY.md
@.planning/phases/02-frontend-connection/02-01-SUMMARY.md
@.planning/phases/03-controls-and-pnl/03-01-SUMMARY.md

**Tech stack available:** Vite plugins, child_process (already imported in vite.config.ts)
**Established patterns:** Custom Vite plugins (versionPlugin, htmlEnvPlugin)
**Constraining decisions:**
- Autopilot backend runs via `tsx src/index.ts` in ../token-analysis-autopilot/
- WebSocket proxy already configured at /autopilot-ws -> ws://localhost:8765

**Key files:**
@apps/web-terminal/vite.config.ts
@apps/web-terminal/src/store/memoryStore/slices/autopilot-store/types.ts
@apps/web-terminal/src/websocket/autopilot/connectAutopilotWebsocket.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create autopilot-startup Vite plugin</name>
  <files>apps/web-terminal/vite.config.ts</files>
  <action>
Add a new Vite plugin `autopilotStartupPlugin` that:

1. Uses `configureServer` hook to spawn autopilot backend when dev server starts
2. Spawns `npx tsx src/index.ts` in `../../token-analysis-autopilot/` directory
3. Stores child process reference for cleanup
4. Pipes stdout/stderr to console with [Autopilot] prefix
5. Kills child process on server close (httpServer.on('close'))
6. Only runs in local development (check VITE_APP_ENV === 'local')

Pattern to follow (similar to existing plugins):
```typescript
const autopilotStartupPlugin = () => ({
  name: "autopilot-startup-plugin",
  configureServer(server) {
    // Only in local dev
    if (process.env.VITE_APP_ENV !== "local") return;

    const autopilotPath = path.resolve(__dirname, "../../token-analysis-autopilot");
    const child = spawn("npx", ["tsx", "src/index.ts"], {
      cwd: autopilotPath,
      stdio: ["ignore", "pipe", "pipe"],
      shell: true,
    });

    child.stdout?.on("data", (data) => console.log(`[Autopilot] ${data}`));
    child.stderr?.on("data", (data) => console.error(`[Autopilot] ${data}`));

    server.httpServer?.on("close", () => {
      child.kill("SIGTERM");
    });
  },
});
```

Add `spawn` to the child_process import (currently only has `execSync`).
Add plugin to plugins array after mkcert (local dev plugins together).
  </action>
  <verify>grep "autopilot-startup-plugin" apps/web-terminal/vite.config.ts returns content</verify>
  <done>vite.config.ts contains autopilotStartupPlugin that spawns backend on server start</done>
</task>

<task type="auto">
  <name>Task 2: Create LOIS_INTEGRATION.md guide</name>
  <files>apps/web-terminal/src/store/memoryStore/slices/autopilot-store/LOIS_INTEGRATION.md</files>
  <action>
Create a consolidated LOIS integration guide that collects all LOIS documentation from Phases 1-3:

1. **Overview** - What this guide is for (PUM3 team reference)
2. **Type Compatibility** - From Phase 1 (LOIS COMPATIBLE markers summary)
3. **Integration Points** - From Phase 2 (where to hook LOIS execution)
4. **Data Format Differences** - From Phase 3 (conversion requirements)
5. **Implementation Checklist** - Steps to enable live trading
6. **Signal Type Mapping** - magic_buy/exit/dump -> TriggerEvent

This satisfies the Phase 4 LOIS Gate: "Consolidate all LOIS docs into LOIS_INTEGRATION.md"

Reference source files:
- types.ts (LOIS INTEGRATION NOTES, LOIS DATA FORMAT DIFFERENCES)
- connectAutopilotWebsocket.ts (LOIS INTEGRATION POINTS)
- Backend websocket-server.ts (LOIS COMPATIBLE markers)
  </action>
  <verify>test -f apps/web-terminal/src/store/memoryStore/slices/autopilot-store/LOIS_INTEGRATION.md</verify>
  <done>LOIS_INTEGRATION.md exists with consolidated documentation from all phases</done>
</task>

<task type="auto">
  <name>Task 3: Verify TypeScript compilation</name>
  <files>apps/web-terminal/vite.config.ts</files>
  <action>
Run TypeScript compilation to verify vite.config.ts compiles without errors.
The new plugin should use proper types from Vite.
  </action>
  <verify>npx tsc --noEmit apps/web-terminal/vite.config.ts 2>&1 | grep -v "error" || echo "Compilation passed"</verify>
  <done>TypeScript compilation passes for vite.config.ts</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] autopilot-startup-plugin exists in vite.config.ts
- [ ] Plugin spawns backend in local dev only
- [ ] Plugin kills backend on server close
- [ ] LOIS_INTEGRATION.md consolidates all LOIS documentation
- [ ] TypeScript compilation passes
- [ ] Phase 4 LOIS Gate satisfied
</verification>

<success_criteria>

- All 3 tasks completed
- All verification checks pass
- Autopilot backend auto-starts with dev server
- LOIS documentation consolidated
- Milestone complete (4/4 phases)
</success_criteria>

<output>
After completion, create `.planning/phases/04-auto-startup/04-01-SUMMARY.md`:

# Phase 4 Plan 1: Auto-Startup Summary

**[One-liner summary of what shipped]**

## Performance

- **Duration:** X min
- **Tasks:** 3/3
- **Files modified:** 2

## Accomplishments

- [Key accomplishments]

## Task Commits

1. **Task 1: Create autopilot-startup Vite plugin** - commit hash (feat)
2. **Task 2: Create LOIS_INTEGRATION.md guide** - commit hash (docs)
3. **Task 3: Verify TypeScript compilation** - verification only

## Files Created/Modified

- `apps/web-terminal/vite.config.ts` - autopilotStartupPlugin added
- `apps/web-terminal/src/store/memoryStore/slices/autopilot-store/LOIS_INTEGRATION.md` - created

## Decisions Made

[Any decisions, or "None"]

## Deviations from Plan

[Any deviations, or "None"]

## Issues Encountered

[Any issues, or "None"]

## Next Phase Readiness

- Phase 4 LOIS Gate satisfied: LOIS_INTEGRATION.md created
- Milestone complete: 4/4 phases done
- Ready for user testing and feedback

---
_Phase: 04-auto-startup_
_Completed: YYYY-MM-DD_
</output>
