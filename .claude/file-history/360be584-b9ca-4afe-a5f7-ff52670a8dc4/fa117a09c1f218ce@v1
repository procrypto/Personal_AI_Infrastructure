# Codebase Structure

**Analysis Date:** 2026-01-13

## Directory Layout

```
local-api/
├── src/                    # Application source code
│   ├── server.ts          # Entry point, route registration
│   ├── config.ts          # Environment config + validation
│   ├── clickhouse/        # Database client
│   │   └── client.ts      # ClickHouse Cloud API client
│   ├── endpoints/         # HTTP endpoint handlers
│   │   ├── _template.ts   # Template for new endpoints
│   │   ├── generic/       # Production-mirror endpoints (15 files)
│   │   └── custom/        # User-defined endpoints
│   └── extensions/        # Extension plugin system
│       ├── types.ts       # ExtensionDefinition interface
│       ├── registry.ts    # /ext/registry endpoint
│       ├── register.ts    # Extension loader
│       └── catalog/       # Extension implementations
├── public/                # Static assets
│   └── smoke.html         # Browser testing dashboard
├── scripts/               # Build/validation scripts
│   └── validate_extensions.ts
├── package.json           # Project manifest
├── tsconfig.json          # TypeScript config
├── bun.lock              # Dependency lock
├── env.example           # Environment template
├── .gitignore            # Git exclusions
├── README.md             # Documentation
└── ai.md                 # AI assistant context
```

## Directory Purposes

**src/:**
- Purpose: All TypeScript source code
- Contains: Server entry, config, endpoints, extensions
- Key files: `server.ts`, `config.ts`

**src/endpoints/generic/:**
- Purpose: Production API mirrors
- Contains: 15 endpoint files (~4100 lines total)
- Key files: `discovery_trending.ts` (564 lines), `token_market_data.ts` (519 lines), `wallet_tracker.ts` (430 lines)

**src/extensions/:**
- Purpose: Local-only data augmentation layer
- Contains: Type definitions, registry, catalog
- Key files: `types.ts`, `catalog/search_token_details.ts`

**src/clickhouse/:**
- Purpose: Database access abstraction
- Contains: Query execution, SQL helpers
- Key files: `client.ts` (clickhouseQuery, escapeString, buildInList, clamp)

## Key File Locations

**Entry Points:**
- `src/server.ts` - HTTP server startup

**Configuration:**
- `src/config.ts` - Environment loading + validation
- `tsconfig.json` - TypeScript compiler options
- `env.example` - Environment variable template

**Core Logic:**
- `src/clickhouse/client.ts` - ClickHouse API client
- `src/endpoints/generic/*.ts` - Endpoint handlers

**Testing:**
- None - no test files present

**Documentation:**
- `README.md` - Comprehensive user documentation
- `ai.md` - AI assistant context
- `src/endpoints/custom/README.md` - Custom endpoint guide

## Naming Conventions

**Files:**
- `snake_case.ts` for all modules (`discovery_trending.ts`, `wallet_tracker.ts`)
- `_template.ts` underscore prefix for templates
- `UPPERCASE.md` for project docs (README, ai.md)

**Directories:**
- lowercase for all directories
- Descriptive names matching content

**Special Patterns:**
- `register*Routes` functions exported from each endpoint
- `validate*Request`, `build*Sql`, `format*Response` helper exports

## Where to Add New Code

**New Endpoint:**
- Primary code: `src/endpoints/generic/my_endpoint.ts`
- Registration: Add import and call in `src/server.ts`
- Template: Copy `src/endpoints/_template.ts`

**New Extension:**
- Implementation: `src/extensions/catalog/my_extension.ts`
- Registration: Add to `src/extensions/catalog/index.ts`
- Interface: Follow `ExtensionDefinition` from `src/extensions/types.ts`

**New Custom Endpoint:**
- Implementation: `src/endpoints/custom/my_custom.ts`
- Registration: Import and call in `src/server.ts`

**Utilities:**
- Shared helpers: Add to `src/clickhouse/client.ts`
- Type definitions: Add to endpoint file or create `src/types/`

## Special Directories

**node_modules/:**
- Purpose: Installed dependencies
- Source: Generated by `bun install`
- Committed: No (in .gitignore)

**dist/:**
- Purpose: TypeScript output (type declarations)
- Source: Generated by `tsc`
- Committed: No (in .gitignore)

**.planning/:**
- Purpose: GSD planning documents
- Source: Generated by GSD workflows
- Committed: Yes

---

*Structure analysis: 2026-01-13*
*Update when directory structure changes*
