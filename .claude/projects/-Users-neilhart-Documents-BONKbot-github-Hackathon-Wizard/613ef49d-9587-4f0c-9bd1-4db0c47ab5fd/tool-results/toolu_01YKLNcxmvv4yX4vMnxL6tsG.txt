     1â†’#!/usr/bin/env node
     2â†’/**
     3â†’ * CLI Interface
     4â†’ *
     5â†’ * Simple CLI for configuring and running the analysis autopilot.
     6â†’ *
     7â†’ * Commands:
     8â†’ *   watch <mint>     - Add token to watchlist
     9â†’ *   unwatch <mint>   - Remove token from watchlist
    10â†’ *   list             - List watchlist
    11â†’ *   templates        - List available templates
    12â†’ *   use <template>   - Add a template to active rules
    13â†’ *   rules            - List active rules
    14â†’ *   config           - Show current config
    15â†’ *   run              - Start analysis loop
    16â†’ */
    17â†’
    18â†’import { configStore } from './config/index.js';
    19â†’import { templates, listTemplates, getTemplate, RuleEngine } from './rules/index.js';
    20â†’import { localApi } from './api/index.js';
    21â†’
    22â†’const HELP = `
    23â†’Token Analysis Autopilot CLI
    24â†’
    25â†’Commands:
    26â†’  watch <mint> [symbol]  Add token to watchlist
    27â†’  unwatch <mint>         Remove token from watchlist
    28â†’  list                   List watchlist
    29â†’
    30â†’  templates              List available rule templates
    31â†’  use <template>         Add a template to active rules
    32â†’  remove <rule-id>       Remove a rule set
    33â†’  rules                  List active rules
    34â†’
    35â†’  config                 Show current config
    36â†’  mode <paper|live>      Set trigger mode
    37â†’  size <sol>             Set default position size
    38â†’
    39â†’  run                    Start analysis loop
    40â†’  analyze <mint>         Analyze a single token
    41â†’
    42â†’  help                   Show this help
    43â†’`;
    44â†’
    45â†’async function main() {
    46â†’  const args = process.argv.slice(2);
    47â†’  const command = args[0]?.toLowerCase();
    48â†’
    49â†’  await configStore.load();
    50â†’
    51â†’  switch (command) {
    52â†’    case 'watch': {
    53â†’      const mint = args[1];
    54â†’      const symbol = args[2];
    55â†’      if (!mint) {
    56â†’        console.error('Usage: watch <mint> [symbol]');
    57â†’        process.exit(1);
    58â†’      }
    59â†’      configStore.addToWatchlist(mint, symbol);
    60â†’      await configStore.save();
    61â†’      console.log(`Added ${symbol || mint} to watchlist`);
    62â†’      break;
    63â†’    }
    64â†’
    65â†’    case 'unwatch': {
    66â†’      const mint = args[1];
    67â†’      if (!mint) {
    68â†’        console.error('Usage: unwatch <mint>');
    69â†’        process.exit(1);
    70â†’      }
    71â†’      if (configStore.removeFromWatchlist(mint)) {
    72â†’        await configStore.save();
    73â†’        console.log(`Removed ${mint} from watchlist`);
    74â†’      } else {
    75â†’        console.log('Token not found in watchlist');
    76â†’      }
    77â†’      break;
    78â†’    }
    79â†’
    80â†’    case 'list': {
    81â†’      const watchlist = configStore.getWatchlist();
    82â†’      if (watchlist.length === 0) {
    83â†’        console.log('Watchlist is empty');
    84â†’      } else {
    85â†’        console.log('\nWatchlist:');
    86â†’        for (const token of watchlist) {
    87â†’          console.log(`  ${token.symbol || 'Unknown'} - ${token.mint}`);
    88â†’        }
    89â†’      }
    90â†’      break;
    91â†’    }
    92â†’
    93â†’    case 'templates': {
    94â†’      console.log('\nAvailable Templates:');
    95â†’      for (const id of listTemplates()) {
    96â†’        const template = templates[id];
    97â†’        console.log(`  ${id}`);
    98â†’        console.log(`    ${template.description}`);
    99â†’        console.log(`    Mode: ${template.mode} (${template.rules.length} rules)`);
   100â†’      }
   101â†’      break;
   102â†’    }
   103â†’
   104â†’    case 'use': {
   105â†’      const templateId = args[1];
   106â†’      if (!templateId) {
   107â†’        console.error('Usage: use <template>');
   108â†’        console.error('Available:', listTemplates().join(', '));
   109â†’        process.exit(1);
   110â†’      }
   111â†’      const template = getTemplate(templateId);
   112â†’      if (!template) {
   113â†’        console.error(`Template not found: ${templateId}`);
   114â†’        console.error('Available:', listTemplates().join(', '));
   115â†’        process.exit(1);
   116â†’      }
   117â†’      configStore.addRuleSet(template);
   118â†’      await configStore.save();
   119â†’      console.log(`Added template: ${template.name}`);
   120â†’      break;
   121â†’    }
   122â†’
   123â†’    case 'remove': {
   124â†’      const ruleId = args[1];
   125â†’      if (!ruleId) {
   126â†’        console.error('Usage: remove <rule-id>');
   127â†’        process.exit(1);
   128â†’      }
   129â†’      if (configStore.removeRuleSet(ruleId)) {
   130â†’        await configStore.save();
   131â†’        console.log(`Removed rule set: ${ruleId}`);
   132â†’      } else {
   133â†’        console.log('Rule set not found');
   134â†’      }
   135â†’      break;
   136â†’    }
   137â†’
   138â†’    case 'rules': {
   139â†’      const ruleSets = configStore.getRuleSets();
   140â†’      if (ruleSets.length === 0) {
   141â†’        console.log('No active rule sets. Use "use <template>" to add one.');
   142â†’      } else {
   143â†’        console.log('\nActive Rule Sets:');
   144â†’        for (const ruleSet of ruleSets) {
   145â†’          console.log(`\n  ${ruleSet.name} (${ruleSet.id})`);
   146â†’          console.log(`    Mode: ${ruleSet.mode}`);
   147â†’          console.log(`    Rules:`);
   148â†’          for (const rule of ruleSet.rules) {
   149â†’            const status = rule.enabled ? 'âœ“' : 'âœ—';
   150â†’            console.log(`      ${status} ${rule.name} (${rule.ruleType})`);
   151â†’          }
   152â†’        }
   153â†’      }
   154â†’      break;
   155â†’    }
   156â†’
   157â†’    case 'config': {
   158â†’      const config = configStore.get();
   159â†’      console.log('\nCurrent Configuration:');
   160â†’      console.log(`  Watchlist: ${config.watchlist.length} tokens`);
   161â†’      console.log(`  Rule Sets: ${config.ruleSets.length} active`);
   162â†’      console.log(`  Trigger Mode: ${config.trigger.mode}`);
   163â†’      console.log(`  Trigger Enabled: ${config.trigger.enabled}`);
   164â†’      console.log(`  Position Size: ${config.trigger.defaultPositionSizeSol} SOL`);
   165â†’      console.log(`  Poll Interval: ${config.pollIntervalMs}ms`);
   166â†’      break;
   167â†’    }
   168â†’
   169â†’    case 'mode': {
   170â†’      const mode = args[1] as 'paper' | 'live';
   171â†’      if (!mode || !['paper', 'live'].includes(mode)) {
   172â†’        console.error('Usage: mode <paper|live>');
   173â†’        process.exit(1);
   174â†’      }
   175â†’      configStore.setTriggerMode(mode);
   176â†’      await configStore.save();
   177â†’      console.log(`Set trigger mode to: ${mode}`);
   178â†’      break;
   179â†’    }
   180â†’
   181â†’    case 'size': {
   182â†’      const size = parseFloat(args[1]);
   183â†’      if (isNaN(size) || size <= 0) {
   184â†’        console.error('Usage: size <sol_amount>');
   185â†’        process.exit(1);
   186â†’      }
   187â†’      configStore.setPositionSize(size);
   188â†’      await configStore.save();
   189â†’      console.log(`Set default position size to: ${size} SOL`);
   190â†’      break;
   191â†’    }
   192â†’
   193â†’    case 'analyze': {
   194â†’      const mint = args[1];
   195â†’      if (!mint) {
   196â†’        console.error('Usage: analyze <mint>');
   197â†’        process.exit(1);
   198â†’      }
   199â†’
   200â†’      const ruleSets = configStore.getRuleSets();
   201â†’      if (ruleSets.length === 0) {
   202â†’        console.error('No active rule sets. Use "use <template>" to add one.');
   203â†’        process.exit(1);
   204â†’      }
   205â†’
   206â†’      console.log(`\nAnalyzing ${mint}...`);
   207â†’
   208â†’      const engine = new RuleEngine({ api: localApi });
   209â†’      for (const ruleSet of ruleSets) {
   210â†’        engine.addRulesFromConfig(ruleSet.rules);
   211â†’      }
   212â†’
   213â†’      const signals = await engine.analyzeToken(mint);
   214â†’      const result = engine.aggregateSignals(signals);
   215â†’
   216â†’      console.log(`\nResult: ${result.action.toUpperCase()} (confidence: ${(result.confidence * 100).toFixed(0)}%)`);
   217â†’
   218â†’      if (signals.length > 0) {
   219â†’        console.log('\nSignals:');
   220â†’        for (const signal of signals) {
   221â†’          const emoji = signal.type === 'buy' ? 'ðŸŸ¢' : signal.type === 'sell' ? 'ðŸ”´' : 'âšª';
   222â†’          console.log(`  ${emoji} ${signal.ruleName}: ${signal.reason}`);
   223â†’        }
   224â†’      } else {
   225â†’        console.log('\nNo signals triggered');
   226â†’      }
   227â†’      break;
   228â†’    }
   229â†’
   230â†’    case 'run': {
   231â†’      console.log('Starting analysis loop... (Ctrl+C to stop)');
   232â†’      // This will be implemented with the trigger system
   233â†’      console.log('Run mode not yet implemented. Use "analyze <mint>" for now.');
   234â†’      break;
   235â†’    }
   236â†’
   237â†’    case 'help':
   238â†’    default:
   239â†’      console.log(HELP);
   240â†’  }
   241â†’}
   242â†’
   243â†’main().catch(console.error);
   244â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
