     1â†’/* eslint-disable lingui/no-unlocalized-strings */
     2â†’import { useState, useEffect } from "react";
     3â†’import {
     4â†’  Bot,
     5â†’  AlertTriangle,
     6â†’  TrendingUp,
     7â†’  TrendingDown,
     8â†’  Activity,
     9â†’  Zap,
    10â†’  Target,
    11â†’  ShieldAlert,
    12â†’  Clock,
    13â†’  Eye,
    14â†’  Flame,
    15â†’  Wallet,
    16â†’  Settings,
    17â†’  RefreshCw,
    18â†’  Power,
    19â†’  Layers,
    20â†’  CheckCircle2,
    21â†’  Circle,
    22â†’} from "lucide-react";
    23â†’import { cn } from "@/lib/utils";
    24â†’import { Switch } from "@/components/switch";
    25â†’import { Tooltip } from "@/components/tooltip";
    26â†’import { useAutopilotSubscription } from "@/hooks/useSubscriptions/useAutopilotSubscription";
    27â†’import {
    28â†’  useAutopilotData,
    29â†’  useTimeAgo,
    30â†’  type AutopilotPositionWithPnL,
    31â†’} from "@/hooks/useAutopilot";
    32â†’import type {
    33â†’  AutopilotSignal,
    34â†’  AutopilotMarketStatus,
    35â†’  AutopilotConfig,
    36â†’  AutopilotStrategies,
    37â†’  AutopilotStats,
    38â†’  WatchedToken,
    39â†’} from "@/store/memoryStore/slices/autopilot-store/types";
    40â†’import type { AutopilotCommand } from "@/websocket/autopilot/AutopilotWebsocket";
    41â†’
    42â†’// Market Status Badge Component
    43â†’const MarketStatusBadge = ({ status }: { status: AutopilotMarketStatus }) => {
    44â†’  const stateConfig = {
    45â†’    NORMAL: {
    46â†’      color: "bg-green-500/20 text-green-400 border-green-500/30",
    47â†’      icon: Activity,
    48â†’      label: "NORMAL",
    49â†’    },
    50â†’    CAUTION: {
    51â†’      color: "bg-yellow-500/20 text-yellow-400 border-yellow-500/30",
    52â†’      icon: AlertTriangle,
    53â†’      label: "CAUTION",
    54â†’    },
    55â†’    DUMP: {
    56â†’      color: "bg-red-500/20 text-red-400 border-red-500/30",
    57â†’      icon: ShieldAlert,
    58â†’      label: "DUMP",
    59â†’    },
    60â†’  };
    61â†’
    62â†’  const config = stateConfig[status.state];
    63â†’  const Icon = config.icon;
    64â†’
    65â†’  return (
    66â†’    <div
    67â†’      className={cn(
    68â†’        "flex items-center gap-2 rounded-lg border px-3 py-1.5",
    69â†’        config.color
    70â†’      )}
    71â†’    >
    72â†’      <Icon className="h-4 w-4" />
    73â†’      <span className="text-xs font-semibold">{config.label}</span>
    74â†’      <span className="text-xs opacity-75">
    75â†’        SOL {status.solPriceChangePercent >= 0 ? "+" : ""}
    76â†’        {status.solPriceChangePercent.toFixed(2)}%
    77â†’      </span>
    78â†’    </div>
    79â†’  );
    80â†’};
    81â†’
    82â†’// Scan Countdown Component - shows live countdown to next scan
    83â†’const ScanCountdown = ({
    84â†’  scanTimestamp,
    85â†’  intervalMs,
    86â†’}: {
    87â†’  scanTimestamp: number | null;
    88â†’  intervalMs: number;
    89â†’}) => {
    90â†’  const [countdown, setCountdown] = useState<number | null>(null);
    91â†’
    92â†’  useEffect(() => {
    93â†’    if (scanTimestamp === null) {
    94â†’      setCountdown(null);
    95â†’      return;
    96â†’    }
    97â†’
    98â†’    const calculateCountdown = () => {
    99â†’      const nextScanTime = scanTimestamp + intervalMs;
   100â†’      const remaining = Math.round((nextScanTime - Date.now()) / 1000);
   101â†’      return remaining;
   102â†’    };
   103â†’
   104â†’    // Initial calculation
   105â†’    setCountdown(calculateCountdown());
   106â†’
   107â†’    // Update every second
   108â†’    const intervalId = setInterval(() => {
   109â†’      setCountdown(calculateCountdown());
   110â†’    }, 1000);
   111â†’
   112â†’    return () => clearInterval(intervalId);
   113â†’  }, [scanTimestamp, intervalMs]);
   114â†’
   115â†’  if (scanTimestamp === null) {
   116â†’    return <span className="text-text-tertiary text-[10px]">Waiting...</span>;
   117â†’  }
   118â†’
   119â†’  if (countdown === null) {
   120â†’    return <span className="text-text-tertiary text-[10px]">Waiting...</span>;
   121â†’  }
   122â†’
   123â†’  if (countdown <= 0) {
   124â†’    return <span className="text-[10px] text-cyan-400">Scanning...</span>;
   125â†’  }
   126â†’
   127â†’  return (
   128â†’    <span className="text-text-secondary text-[10px]">Next: {countdown}s</span>
   129â†’  );
   130â†’};
   131â†’
   132â†’// Position Card Component - handles nullable P&L from NATS market data
   133â†’const PositionCard = ({ position }: { position: AutopilotPositionWithPnL }) => {
   134â†’  const isProfit = (position.pnlPercent ?? 0) >= 0;
   135â†’  const holdTime = Math.floor((Date.now() - position.entryTime) / 60000); // minutes
   136â†’  const hasMarketData = position.pnlPercent !== null;
   137â†’
   138â†’  return (
   139â†’    <div className="border-border-primary bg-bg-tertiary/50 flex items-center justify-between rounded-lg border p-3">
   140â†’      <div className="flex items-center gap-3">
   141â†’        <div
   142â†’          className={cn(
   143â†’            "flex h-8 w-8 items-center justify-center rounded-lg text-xs font-bold",
   144â†’            hasMarketData
   145â†’              ? isProfit
   146â†’                ? "bg-green-500/20 text-green-400"
   147â†’                : "bg-red-500/20 text-red-400"
   148â†’              : "bg-gray-500/20 text-gray-400"
   149â†’          )}
   150â†’        >
   151â†’          {hasMarketData ? (
   152â†’            isProfit ? (
   153â†’              <TrendingUp className="h-4 w-4" />
   154â†’            ) : (
   155â†’              <TrendingDown className="h-4 w-4" />
   156â†’            )
   157â†’          ) : (
   158â†’            <Activity className="h-4 w-4 animate-pulse" />
   159â†’          )}
   160â†’        </div>
   161â†’        <div>
   162â†’          <span className="text-text-primary text-sm font-medium">
   163â†’            ${position.symbol}
   164â†’          </span>
   165â†’          <div className="text-text-secondary flex items-center gap-1 text-[10px]">
   166â†’            <Clock className="h-3 w-3" />
   167â†’            {holdTime}m
   168â†’          </div>
   169â†’        </div>
   170â†’      </div>
   171â†’      <div className="text-right">
   172â†’        {hasMarketData ? (
   173â†’          <>
   174â†’            <div
   175â†’              className={cn(
   176â†’                "text-sm font-semibold",
   177â†’                isProfit ? "text-green-400" : "text-red-400"
   178â†’              )}
   179â†’            >
   180â†’              {isProfit ? "+" : ""}
   181â†’              {position.pnlPercent!.toFixed(2)}%
   182â†’            </div>
   183â†’            <div className="text-text-secondary text-[10px]">
   184â†’              {position.positionSizeSol.toFixed(2)} SOL
   185â†’            </div>
   186â†’          </>
   187â†’        ) : (
   188â†’          <>
   189â†’            <div className="text-text-tertiary animate-pulse text-sm font-semibold">
   190â†’              Loading...
   191â†’            </div>
   192â†’            <div className="text-text-secondary text-[10px]">
   193â†’              {position.positionSizeSol.toFixed(2)} SOL
   194â†’            </div>
   195â†’          </>
   196â†’        )}
   197â†’      </div>
   198â†’    </div>
   199â†’  );
   200â†’};
   201â†’
   202â†’// Signal Item Component
   203â†’const SignalItem = ({ signal }: { signal: AutopilotSignal }) => {
   204â†’  const signalConfig = {
   205â†’    magic_buy: { color: "text-cyan-400", icon: Target, label: "BUY" },
   206â†’    magic_exit: { color: "text-purple-400", icon: Zap, label: "EXIT" },
   207â†’    dump_exit: { color: "text-red-400", icon: ShieldAlert, label: "DUMP" },
   208â†’    rule_signal: { color: "text-blue-400", icon: Activity, label: "SIGNAL" },
   209â†’  };
   210â†’
   211â†’  const config = signalConfig[signal.signalType];
   212â†’  const Icon = config.icon;
   213â†’  const time = new Date(signal.timestamp).toLocaleTimeString("en-US", {
   214â†’    hour12: false,
   215â†’    hour: "2-digit",
   216â†’    minute: "2-digit",
   217â†’    second: "2-digit",
   218â†’  });
   219â†’
   220â†’  return (
   221â†’    <div className="border-border-primary/50 flex items-center gap-2 border-b py-2 last:border-0">
   222â†’      <Icon className={cn("h-3.5 w-3.5", config.color)} />
   223â†’      <span className="text-text-secondary text-[10px]">{time}</span>
   224â†’      <span className={cn("text-xs font-medium", config.color)}>
   225â†’        {config.label}
   226â†’      </span>
   227â†’      <span className="text-text-primary text-xs">${signal.symbol}</span>
   228â†’      {signal.pnlPercent !== undefined && (
   229â†’        <span
   230â†’          className={cn(
   231â†’            "text-xs",
   232â†’            signal.pnlPercent >= 0 ? "text-green-400" : "text-red-400"
   233â†’          )}
   234â†’        >
   235â†’          {signal.pnlPercent >= 0 ? "+" : ""}
   236â†’          {signal.pnlPercent.toFixed(1)}%
   237â†’        </span>
   238â†’      )}
   239â†’    </div>
   240â†’  );
   241â†’};
   242â†’
   243â†’// Token Row Component
   244â†’const TokenRow = ({ token }: { token: WatchedToken }) => {
   245â†’  const change = token.change1h ?? 0;
   246â†’  const isPositive = change >= 0;
   247â†’
   248â†’  return (
   249â†’    <div
   250â†’      className={cn(
   251â†’        "flex items-center justify-between rounded px-2 py-1.5 text-xs",
   252â†’        token.hasPosition
   253â†’          ? "border border-cyan-500/20 bg-cyan-500/10"
   254â†’          : "bg-bg-tertiary/30"
   255â†’      )}
   256â†’    >
   257â†’      <div className="flex items-center gap-2">
   258â†’        <span className="text-text-primary font-medium">${token.symbol}</span>
   259â†’        {token.hasPosition && (
   260â†’          <span className="text-[8px] font-semibold text-cyan-400">OPEN</span>
   261â†’        )}
   262â†’      </div>
   263â†’      <div className="flex items-center gap-3">
   264â†’        {token.priceUsd !== undefined && (
   265â†’          <span className="text-text-secondary">
   266â†’            $
   267â†’            {token.priceUsd < 0.01
   268â†’              ? token.priceUsd.toExponential(2)
   269â†’              : token.priceUsd.toFixed(4)}
   270â†’          </span>
   271â†’        )}
   272â†’        <span
   273â†’          className={cn(
   274â†’            "font-medium",
   275â†’            isPositive ? "text-green-400" : "text-red-400"
   276â†’          )}
   277â†’        >
   278â†’          {isPositive ? "+" : ""}
   279â†’          {change.toFixed(1)}%
   280â†’        </span>
   281â†’      </div>
   282â†’    </div>
   283â†’  );
   284â†’};
   285â†’
   286â†’// Token List Section Component
   287â†’const TokenListSection = ({
   288â†’  title,
   289â†’  icon: Icon,
   290â†’  tokens,
   291â†’  iconColor,
   292â†’}: {
   293â†’  title: string;
   294â†’  icon: React.ElementType;
   295â†’  tokens: WatchedToken[];
   296â†’  iconColor: string;
   297â†’}) => {
   298â†’  if (tokens.length === 0) return null;
   299â†’
   300â†’  return (
   301â†’    <div className="flex-shrink-0">
   302â†’      <div className="text-text-secondary mb-1.5 flex items-center gap-2 text-xs font-medium">
   303â†’        <Icon className={cn("h-3.5 w-3.5", iconColor)} />
   304â†’        {title} ({tokens.length})
   305â†’      </div>
   306â†’      <div className="max-h-32 space-y-1 overflow-auto">
   307â†’        {tokens.map(token => (
   308â†’          <TokenRow
   309â†’            key={token.mint}
   310â†’            token={token}
   311â†’          />
   312â†’        ))}
   313â†’      </div>
   314â†’    </div>
   315â†’  );
   316â†’};
   317â†’
   318â†’// Controls Panel Component
   319â†’const ControlsPanel = ({
   320â†’  config,
   321â†’  sendCommand,
   322â†’  isConnected,
   323â†’}: {
   324â†’  config: AutopilotConfig;
   325â†’  sendCommand: (cmd: AutopilotCommand) => void;
   326â†’  isConnected: boolean;
   327â†’}) => {
   328â†’  const [showControls, setShowControls] = useState(false);
   329â†’
   330â†’  return (
   331â†’    <div className="border-border-primary bg-bg-tertiary/30 rounded-lg border">
   332â†’      {/* Header - always visible */}
   333â†’      <button
   334â†’        onClick={() => setShowControls(!showControls)}
   335â†’        className="flex w-full items-center justify-between px-3 py-2 text-xs"
   336â†’        disabled={!isConnected}
   337â†’      >
   338â†’        <div className="flex items-center gap-2">
   339â†’          <Settings className="text-text-secondary h-3.5 w-3.5" />
   340â†’          <span className="text-text-secondary font-medium">Controls</span>
   341â†’        </div>
   342â†’        <div className="flex items-center gap-2">
   343â†’          <span
   344â†’            className={cn(
   345â†’              "rounded px-1.5 py-0.5 text-[10px] font-semibold",
   346â†’              config.mode === "paper"
   347â†’                ? "bg-yellow-500/20 text-yellow-400"
   348â†’                : "bg-green-500/20 text-green-400"
   349â†’            )}
   350â†’          >
   351â†’            {config.mode.toUpperCase()}
   352â†’          </span>
   353â†’          <span className="text-text-tertiary">{showControls ? "â–²" : "â–¼"}</span>
   354â†’        </div>
   355â†’      </button>
   356â†’
   357â†’      {/* Expandable controls */}
   358â†’      {showControls && (
   359â†’        <div className="border-border-primary/50 space-y-3 border-t px-3 py-2">
   360â†’          {/* Mode Toggle - Disabled until LOIS integration */}
   361â†’          <Tooltip
   362â†’            content="Live trading integration coming soon. Invite only ğŸ”’"
   363â†’            side="left"
   364â†’            triggerClassName="w-full"
   365â†’          >
   366â†’            <div className="flex w-full cursor-not-allowed items-center justify-between opacity-50">
   367â†’              <div className="flex items-center gap-2">
   368â†’                <Power className="text-text-secondary h-3.5 w-3.5" />
   369â†’                <span className="text-text-secondary text-xs">
   370â†’                  Live Trading
   371â†’                </span>
   372â†’              </div>
   373â†’              <Switch
   374â†’                size="sm"
   375â†’                checked={false}
   376â†’                disabled
   377â†’              />
   378â†’            </div>
   379â†’          </Tooltip>
   380â†’
   381â†’          {/* Auto Sources Toggle */}
   382â†’          <div className="flex items-center justify-between">
   383â†’            <div className="flex items-center gap-2">
   384â†’              <Eye className="h-3.5 w-3.5 text-blue-400" />
   385â†’              <span className="text-text-secondary text-xs">Auto Sources</span>
   386â†’            </div>
   387â†’            <Switch
   388â†’              size="sm"
   389â†’              checked={config.autoSourcesEnabled}
   390â†’              onCheckedChange={checked =>
   391â†’                sendCommand({ command: "toggle_sources", enabled: checked })
   392â†’              }
   393â†’            />
   394â†’          </div>
   395â†’
   396â†’          {/* Trending Toggle */}
   397â†’          {config.autoSourcesEnabled && (
   398â†’            <div className="flex items-center justify-between pl-5">
   399â†’              <div className="flex items-center gap-2">
   400â†’                <Flame className="h-3 w-3 text-orange-400" />
   401â†’                <span className="text-text-tertiary text-[11px]">Trending</span>
   402â†’              </div>
   403â†’              <Switch
   404â†’                size="sm"
   405â†’                checked={config.trendingEnabled}
   406â†’                onCheckedChange={checked =>
   407â†’                  sendCommand({ command: "toggle_trending", enabled: checked })
   408â†’                }
   409â†’              />
   410â†’            </div>
   411â†’          )}
   412â†’
   413â†’          {/* Whales Toggle */}
   414â†’          {config.autoSourcesEnabled && (
   415â†’            <div className="flex items-center justify-between pl-5">
   416â†’              <div className="flex items-center gap-2">
   417â†’                <Wallet className="h-3 w-3 text-green-400" />
   418â†’                <span className="text-text-tertiary text-[11px]">
   419â†’                  Whale Moves
   420â†’                </span>
   421â†’              </div>
   422â†’              <Switch
   423â†’                size="sm"
   424â†’                checked={config.whalesEnabled}
   425â†’                onCheckedChange={checked =>
   426â†’                  sendCommand({ command: "toggle_whales", enabled: checked })
   427â†’                }
   428â†’              />
   429â†’            </div>
   430â†’          )}
   431â†’
   432â†’          {/* Market Filter Toggle */}
   433â†’          <div className="flex items-center justify-between">
   434â†’            <div className="flex items-center gap-2">
   435â†’              <ShieldAlert className="h-3.5 w-3.5 text-purple-400" />
   436â†’              <span className="text-text-secondary text-xs">Market Filter</span>
   437â†’            </div>
   438â†’            <Switch
   439â†’              size="sm"
   440â†’              checked={config.marketFilterEnabled}
   441â†’              onCheckedChange={checked =>
   442â†’                sendCommand({ command: "toggle_filter", enabled: checked })
   443â†’              }
   444â†’            />
   445â†’          </div>
   446â†’
   447â†’          {/* Refresh Sources Button */}
   448â†’          <button
   449â†’            onClick={() => sendCommand({ command: "refresh_sources" })}
   450â†’            className="bg-bg-tertiary/50 text-text-secondary hover:bg-bg-tertiary flex w-full items-center justify-center gap-2 rounded px-3 py-1.5 text-xs transition-colors"
   451â†’          >
   452â†’            <RefreshCw className="h-3 w-3" />
   453â†’            Refresh Sources
   454â†’          </button>
   455â†’
   456â†’          {/* Position Size Display */}
   457â†’          <div className="text-text-tertiary border-border-primary/30 flex items-center justify-between border-t pt-1 text-[10px]">
   458â†’            <span>Position Size</span>
   459â†’            <span>{config.positionSizeSol} SOL</span>
   460â†’          </div>
   461â†’        </div>
   462â†’      )}
   463â†’    </div>
   464â†’  );
   465â†’};
   466â†’
   467â†’// Strategies Panel Component
   468â†’const StrategiesPanel = ({
   469â†’  strategies,
   470â†’  sendCommand,
   471â†’  isConnected,
   472â†’}: {
   473â†’  strategies: AutopilotStrategies;
   474â†’  sendCommand: (cmd: AutopilotCommand) => void;
   475â†’  isConnected: boolean;
   476â†’}) => {
   477â†’  const [showStrategies, setShowStrategies] = useState(false);
   478â†’  const activeSet = new Set(strategies.active);
   479â†’
   480â†’  return (
   481â†’    <div className="border-border-primary bg-bg-tertiary/30 rounded-lg border">
   482â†’      {/* Header - always visible */}
   483â†’      <button
   484â†’        onClick={() => setShowStrategies(!showStrategies)}
   485â†’        className="flex w-full items-center justify-between px-3 py-2 text-xs"
   486â†’        disabled={!isConnected}
   487â†’      >
   488â†’        <div className="flex items-center gap-2">
   489â†’          <Layers className="text-text-secondary h-3.5 w-3.5" />
   490â†’          <span className="text-text-secondary font-medium">Strategies</span>
   491â†’        </div>
   492â†’        <div className="flex items-center gap-2">
   493â†’          <span
   494â†’            className={cn(
   495â†’              "rounded px-1.5 py-0.5 text-[10px] font-semibold",
   496â†’              strategies.active.length > 0
   497â†’                ? "bg-green-500/20 text-green-400"
   498â†’                : "bg-gray-500/20 text-gray-400"
   499â†’            )}
   500â†’          >
   501â†’            {strategies.active.length} ACTIVE
   502â†’          </span>
   503â†’          <span className="text-text-tertiary">
   504â†’            {showStrategies ? "â–²" : "â–¼"}
   505â†’          </span>
   506â†’        </div>
   507â†’      </button>
   508â†’
   509â†’      {/* Expandable strategies list */}
   510â†’      {showStrategies && (
   511â†’        <div className="border-border-primary/50 space-y-2 border-t px-3 py-2">
   512â†’          {strategies.available.length === 0 ? (
   513â†’            <div className="text-text-tertiary py-2 text-center text-xs">
   514â†’              No strategies available
   515â†’            </div>
   516â†’          ) : (
   517â†’            strategies.available.map(strategy => {
   518â†’              const isActive = activeSet.has(strategy.id);
   519â†’              return (
   520â†’                <button
   521â†’                  key={strategy.id}
   522â†’                  onClick={() =>
   523â†’                    sendCommand({
   524â†’                      command: "toggle_strategy",
   525â†’                      strategyId: strategy.id,
   526â†’                      enabled: !isActive,
   527â†’                    })
   528â†’                  }
   529â†’                  className={cn(
   530â†’                    "flex w-full items-start gap-2 rounded px-2 py-2 text-left transition-colors",
   531â†’                    isActive
   532â†’                      ? "border border-green-500/30 bg-green-500/10 hover:bg-green-500/20"
   533â†’                      : "bg-bg-tertiary/50 hover:bg-bg-tertiary border border-transparent"
   534â†’                  )}
   535â†’                >
   536â†’                  <div className="mt-0.5 flex-shrink-0">
   537â†’                    {isActive ? (
   538â†’                      <CheckCircle2 className="h-4 w-4 text-green-400" />
   539â†’                    ) : (
   540â†’                      <Circle className="text-text-tertiary h-4 w-4" />
   541â†’                    )}
   542â†’                  </div>
   543â†’                  <div className="min-w-0 flex-1">
   544â†’                    <div className="flex items-center gap-2">
   545â†’                      <span
   546â†’                        className={cn(
   547â†’                          "text-xs font-medium",
   548â†’                          isActive ? "text-green-400" : "text-text-primary"
   549â†’                        )}
   550â†’                      >
   551â†’                        {strategy.name}
   552â†’                      </span>
   553â†’                      <span
   554â†’                        className={cn(
   555â†’                          "rounded px-1 py-0.5 text-[9px]",
   556â†’                          strategy.mode === "all"
   557â†’                            ? "bg-blue-500/20 text-blue-400"
   558â†’                            : "bg-purple-500/20 text-purple-400"
   559â†’                        )}
   560â†’                      >
   561â†’                        {strategy.mode.toUpperCase()}
   562â†’                      </span>
   563â†’                    </div>
   564â†’                    <div className="text-text-tertiary truncate text-[10px]">
   565â†’                      {strategy.summary}
   566â†’                    </div>
   567â†’                  </div>
   568â†’                </button>
   569â†’              );
   570â†’            })
   571â†’          )}
   572â†’        </div>
   573â†’      )}
   574â†’    </div>
   575â†’  );
   576â†’};
   577â†’
   578â†’// Stats Panel Component
   579â†’const StatsPanel = ({ stats }: { stats: AutopilotStats }) => {
   580â†’  const isProfit = stats.totalPnlSol >= 0;
   581â†’
   582â†’  return (
   583â†’    <div className="border-border-primary bg-bg-tertiary/30 grid grid-cols-4 gap-2 rounded-lg border p-3">
   584â†’      <div className="text-center">
   585â†’        <div className="text-text-primary text-lg font-bold">
   586â†’          {stats.closedTrades}
   587â†’        </div>
   588â†’        <div className="text-text-secondary text-[10px]">Trades</div>
   589â†’      </div>
   590â†’      <div className="text-center">
   591â†’        <div
   592â†’          className={cn(
   593â†’            "text-lg font-bold",
   594â†’            stats.winRate >= 0.5 ? "text-green-400" : "text-red-400"
   595â†’          )}
   596â†’        >
   597â†’          {(stats.winRate * 100).toFixed(0)}%
   598â†’        </div>
   599â†’        <div className="text-text-secondary text-[10px]">Win Rate</div>
   600â†’      </div>
   601â†’      <div className="text-center">
   602â†’        <div className="text-text-primary text-lg font-bold">
   603â†’          {stats.wins}W/{stats.losses}L
   604â†’        </div>
   605â†’        <div className="text-text-secondary text-[10px]">Record</div>
   606â†’      </div>
   607â†’      <div className="text-center">
   608â†’        <div
   609â†’          className={cn(
   610â†’            "text-lg font-bold",
   611â†’            isProfit ? "text-green-400" : "text-red-400"
   612â†’          )}
   613â†’        >
   614â†’          {isProfit ? "+" : ""}
   615â†’          {stats.totalPnlSol.toFixed(2)}
   616â†’        </div>
   617â†’        <div className="text-text-secondary text-[10px]">P&L (SOL)</div>
   618â†’      </div>
   619â†’    </div>
   620â†’  );
   621â†’};
   622â†’
   623â†’// Last Analysis Row Component
   624â†’const LastAnalysisRow = ({
   625â†’  analysis,
   626â†’}: {
   627â†’  analysis: {
   628â†’    symbol: string;
   629â†’    timestamp: number;
   630â†’    priceChange5m: number | null;
   631â†’    priceChange1h: number | null;
   632â†’    buySellRatio: number | null;
   633â†’    rulesChecked: number;
   634â†’    rulesMatched: number;
   635â†’    outcome: string;
   636â†’    reason: string;
   637â†’  } | null;
   638â†’}) => {
   639â†’  // Use live-updating time ago hook
   640â†’  const timeStr = useTimeAgo(analysis?.timestamp);
   641â†’
   642â†’  if (!analysis) return null;
   643â†’
   644â†’  const outcomeConfig = {
   645â†’    no_signal: { color: "text-gray-400", bg: "bg-gray-500/10" },
   646â†’    buy_signal: { color: "text-green-400", bg: "bg-green-500/10" },
   647â†’    sell_signal: { color: "text-red-400", bg: "bg-red-500/10" },
   648â†’    skipped: { color: "text-yellow-400", bg: "bg-yellow-500/10" },
   649â†’  };
   650â†’
   651â†’  const config =
   652â†’    outcomeConfig[analysis.outcome as keyof typeof outcomeConfig] ||
   653â†’    outcomeConfig.no_signal;
   654â†’
   655â†’  return (
   656â†’    <div
   657â†’      className={cn("border-border-primary rounded-lg border p-2", config.bg)}
   658â†’    >
   659â†’      <div className="flex items-center justify-between">
   660â†’        <div className="flex items-center gap-2">
   661â†’          <Activity className={cn("h-3.5 w-3.5", config.color)} />
   662â†’          <span className="text-text-primary text-xs font-medium">
   663â†’            ${analysis.symbol}
   664â†’          </span>
   665â†’          <span className="text-text-tertiary text-[10px]">{timeStr}</span>
   666â†’        </div>
   667â†’        <div className="flex items-center gap-2">
   668â†’          <span className={cn("text-[10px] font-semibold", config.color)}>
   669â†’            {analysis.rulesMatched}/{analysis.rulesChecked}
   670â†’          </span>
   671â†’        </div>
   672â†’      </div>
   673â†’      <div className="mt-1 flex items-center gap-3 text-[10px]">
   674â†’        {analysis.priceChange5m !== null && (
   675â†’          <span
   676â†’            className={
   677â†’              analysis.priceChange5m >= 0 ? "text-green-400" : "text-red-400"
   678â†’            }
   679â†’          >
   680â†’            5m: {analysis.priceChange5m >= 0 ? "+" : ""}
   681â†’            {analysis.priceChange5m.toFixed(2)}%
   682â†’          </span>
   683â†’        )}
   684â†’        {analysis.priceChange1h !== null && (
   685â†’          <span
   686â†’            className={
   687â†’              analysis.priceChange1h >= 0 ? "text-green-400" : "text-red-400"
   688â†’            }
   689â†’          >
   690â†’            1h: {analysis.priceChange1h >= 0 ? "+" : ""}
   691â†’            {analysis.priceChange1h.toFixed(2)}%
   692â†’          </span>
   693â†’        )}
   694â†’        {analysis.buySellRatio !== null && (
   695â†’          <span className="text-text-secondary">
   696â†’            B/S: {analysis.buySellRatio.toFixed(1)}:1
   697â†’          </span>
   698â†’        )}
   699â†’      </div>
   700â†’      <div className="text-text-tertiary mt-1 truncate text-[9px]">
   701â†’        {analysis.reason}
   702â†’      </div>
   703â†’    </div>
   704â†’  );
   705â†’};
   706â†’
   707â†’// Section Header Component
   708â†’const SectionHeader = ({ children }: { children: React.ReactNode }) => (
   709â†’  <div className="text-text-tertiary mb-1.5 text-[10px] font-medium tracking-wide uppercase">
   710â†’    {children}
   711â†’  </div>
   712â†’);
   713â†’
   714â†’// Collapsible Section Component - follows ControlsPanel/StrategiesPanel pattern
   715â†’const CollapsibleSection = ({
   716â†’  title,
   717â†’  defaultExpanded = true,
   718â†’  children,
   719â†’}: {
   720â†’  title: string;
   721â†’  defaultExpanded?: boolean;
   722â†’  children: React.ReactNode;
   723â†’}) => {
   724â†’  const [expanded, setExpanded] = useState(defaultExpanded);
   725â†’
   726â†’  return (
   727â†’    <div
   728â†’      className={cn(
   729â†’        "flex flex-shrink-0 flex-col transition-opacity duration-200",
   730â†’        !expanded && "opacity-75"
   731â†’      )}
   732â†’    >
   733â†’      <button
   734â†’        onClick={() => setExpanded(!expanded)}
   735â†’        className={cn(
   736â†’          "flex cursor-pointer items-center gap-1.5 text-[10px] font-medium tracking-wide uppercase transition-colors",
   737â†’          expanded
   738â†’            ? "text-text-tertiary hover:text-text-secondary mb-1.5"
   739â†’            : "text-text-tertiary/80 hover:text-text-secondary hover:border-border-primary/30 hover:bg-bg-tertiary/30 rounded border border-transparent px-1.5 py-1"
   740â†’        )}
   741â†’      >
   742â†’        <span
   743â†’          className={cn(
   744â†’            "text-[8px] transition-transform duration-200",
   745â†’            expanded ? "rotate-0" : "-rotate-90"
   746â†’          )}
   747â†’        >
   748â†’          â–¼
   749â†’        </span>
   750â†’        {title}
   751â†’        {!expanded && (
   752â†’          <span className="text-text-tertiary/60 ml-auto text-[8px] font-normal normal-case">
   753â†’            click to expand
   754â†’          </span>
   755â†’        )}
   756â†’      </button>
   757â†’      <div
   758â†’        className={cn(
   759â†’          "grid transition-all duration-200",
   760â†’          expanded ? "grid-rows-[1fr] opacity-100" : "grid-rows-[0fr] opacity-0"
   761â†’        )}
   762â†’      >
   763â†’        <div className="overflow-hidden">
   764â†’          <div className="flex flex-col gap-2">{children}</div>
   765â†’        </div>
   766â†’      </div>
   767â†’    </div>
   768â†’  );
   769â†’};
   770â†’
   771â†’// Main Autopilot Widget Component
   772â†’export const AutopilotWidget = () => {
   773â†’  // Connect to autopilot backend and auto-subscribe to NATS market data
   774â†’  useAutopilotSubscription({ isEnabled: true });
   775â†’
   776â†’  // Get all autopilot data from Zustand store
   777â†’  const {
   778â†’    positions,
   779â†’    signals,
   780â†’    marketStatus,
   781â†’    stats,
   782â†’    scanTick,
   783â†’    lastAnalysis,
   784â†’    tokenList,
   785â†’    config,
   786â†’    strategies,
   787â†’    isConnected,
   788â†’    sendCommand,
   789â†’  } = useAutopilotData();
   790â†’
   791â†’  const totalTokens =
   792â†’    tokenList.watchlist.length +
   793â†’    tokenList.trending.length +
   794â†’    tokenList.whales.length;
   795â†’
   796â†’  return (
   797â†’    <div className="flex h-full flex-col gap-4 overflow-hidden">
   798â†’      {/* Header - Market Status */}
   799â†’      <div className="flex items-center justify-between">
   800â†’        <div className="flex items-center gap-2">
   801â†’          <Bot
   802â†’            className={cn(
   803â†’              "h-5 w-5",
   804â†’              isConnected ? "text-green-400" : "text-red-400"
   805â†’            )}
   806â†’          />
   807â†’          <span className="text-text-primary text-sm font-semibold">
   808â†’            Token Autopilot
   809â†’          </span>
   810â†’          {scanTick && (
   811â†’            <span className="text-text-secondary text-[10px]">
   812â†’              #{scanTick.scanNumber} | {totalTokens} tokens
   813â†’            </span>
   814â†’          )}
   815â†’          {isConnected && (
   816â†’            <>
   817â†’              <span className="text-text-tertiary text-[10px]">|</span>
   818â†’              <ScanCountdown
   819â†’                scanTimestamp={scanTick?.timestamp ?? null}
   820â†’                intervalMs={config.pollIntervalMs}
   821â†’              />
   822â†’            </>
   823â†’          )}
   824â†’        </div>
   825â†’        <MarketStatusBadge status={marketStatus} />
   826â†’      </div>
   827â†’
   828â†’      {/* Connection Status - Always visible when disconnected */}
   829â†’      {!isConnected && (
   830â†’        <div className="flex items-center gap-2 rounded-lg border border-yellow-500/30 bg-yellow-500/10 px-3 py-2">
   831â†’          <AlertTriangle className="h-4 w-4 text-yellow-400" />
   832â†’          <span className="text-xs text-yellow-400">
   833â†’            Connecting to autopilot backend...
   834â†’          </span>
   835â†’        </div>
   836â†’      )}
   837â†’
   838â†’      {/* â•â•â• PERFORMANCE SECTION â•â•â• */}
   839â†’      <CollapsibleSection
   840â†’        title="Performance"
   841â†’        defaultExpanded={true}
   842â†’      >
   843â†’        <StatsPanel stats={stats} />
   844â†’
   845â†’        {/* Open Positions */}
   846â†’        {positions.length > 0 && (
   847â†’          <div>
   848â†’            <div className="text-text-secondary mb-1.5 flex items-center gap-2 text-xs font-medium">
   849â†’              <Target className="h-3.5 w-3.5" />
   850â†’              Open Positions ({positions.length})
   851â†’            </div>
   852â†’            <div className="max-h-40 space-y-2 overflow-auto">
   853â†’              {positions.map(pos => (
   854â†’                <PositionCard
   855â†’                  key={pos.mint}
   856â†’                  position={pos}
   857â†’                />
   858â†’              ))}
   859â†’            </div>
   860â†’          </div>
   861â†’        )}
   862â†’      </CollapsibleSection>
   863â†’
   864â†’      {/* â•â•â• ACTIVITY SECTION â•â•â• */}
   865â†’      <CollapsibleSection
   866â†’        title="Activity"
   867â†’        defaultExpanded={true}
   868â†’      >
   869â†’        <LastAnalysisRow analysis={lastAnalysis} />
   870â†’
   871â†’        {/* Recent Signals */}
   872â†’        {signals.length > 0 && (
   873â†’          <div>
   874â†’            <div className="text-text-secondary mb-1.5 flex items-center gap-2 text-xs font-medium">
   875â†’              <Zap className="h-3.5 w-3.5" />
   876â†’              Recent Signals
   877â†’            </div>
   878â†’            <div className="max-h-24 overflow-auto">
   879â†’              <div className="space-y-0">
   880â†’                {signals.slice(0, 5).map((signal, idx) => (
   881â†’                  <SignalItem
   882â†’                    key={`${signal.timestamp}-${idx}`}
   883â†’                    signal={signal}
   884â†’                  />
   885â†’                ))}
   886â†’              </div>
   887â†’            </div>
   888â†’          </div>
   889â†’        )}
   890â†’      </CollapsibleSection>
   891â†’
   892â†’      {/* â•â•â• TOKEN WATCH SECTION â•â•â• (Main scrollable area) */}
   893â†’      <div className="flex min-h-0 flex-1 flex-col gap-2 overflow-auto">
   894â†’        <SectionHeader>Tokens</SectionHeader>
   895â†’
   896â†’        {/* Watchlist */}
   897â†’        <TokenListSection
   898â†’          title="Watchlist"
   899â†’          icon={Eye}
   900â†’          tokens={tokenList.watchlist}
   901â†’          iconColor="text-blue-400"
   902â†’        />
   903â†’
   904â†’        {/* Trending */}
   905â†’        <TokenListSection
   906â†’          title="Trending"
   907â†’          icon={Flame}
   908â†’          tokens={tokenList.trending}
   909â†’          iconColor="text-orange-400"
   910â†’        />
   911â†’
   912â†’        {/* Whale Moves */}
   913â†’        <TokenListSection
   914â†’          title="Whale Moves"
   915â†’          icon={Wallet}
   916â†’          tokens={tokenList.whales}
   917â†’          iconColor="text-green-400"
   918â†’        />
   919â†’
   920â†’        {/* Empty state if no tokens */}
   921â†’        {totalTokens === 0 && isConnected && (
   922â†’          <div className="text-text-secondary border-border-primary/50 rounded-lg border border-dashed p-4 text-center text-xs">
   923â†’            No tokens being watched. Enable auto-sources or add to watchlist.
   924â†’          </div>
   925â†’        )}
   926â†’      </div>
   927â†’
   928â†’      {/* â•â•â• CONFIGURATION SECTION â•â•â• */}
   929â†’      <div className="border-border-primary/30 flex flex-shrink-0 flex-col gap-2 border-t pt-3">
   930â†’        <SectionHeader>Configuration</SectionHeader>
   931â†’        <ControlsPanel
   932â†’          config={config}
   933â†’          sendCommand={sendCommand}
   934â†’          isConnected={isConnected}
   935â†’        />
   936â†’        <StrategiesPanel
   937â†’          strategies={strategies}
   938â†’          sendCommand={sendCommand}
   939â†’          isConnected={isConnected}
   940â†’        />
   941â†’      </div>
   942â†’    </div>
   943â†’  );
   944â†’};
   945â†’
   946â†’export default AutopilotWidget;
   947â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
