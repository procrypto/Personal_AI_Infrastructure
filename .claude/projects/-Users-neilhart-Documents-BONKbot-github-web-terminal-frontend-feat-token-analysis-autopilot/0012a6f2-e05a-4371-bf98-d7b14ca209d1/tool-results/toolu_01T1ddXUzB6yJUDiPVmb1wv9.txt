     1â†’# Roadmap: Autopilot Frontend Integration
     2â†’
     3â†’## Overview
     4â†’
     5â†’Bring the token-analysis-autopilot CLI's paper trading capabilities into the web-terminal dashboard widget. Starting with backend WebSocket protocol, then frontend connection, then controls and live P&L. Stretch goal: auto-start backend with dev server.
     6â†’
     7â†’## Milestones
     8â†’
     9â†’- âœ… **v1.0 Autopilot Frontend Integration** - Phases 1-4 (shipped 2026-01-08)
    10â†’- ðŸš§ **v1.1 Autopilot Unit Tests** - Phase 5 (in progress)
    11â†’
    12â†’## Domain Expertise
    13â†’
    14â†’None
    15â†’
    16â†’## Cross-Cutting Concern: LOIS Documentation
    17â†’
    18â†’Every phase must advance LOIS integration readiness (per serene-prancing-platypus.md):
    19â†’
    20â†’- **Phase 1**: Add LOIS compatibility comments to data types and TriggerEvent
    21â†’- **Phase 2**: Document integration points with `// LOIS INTEGRATION POINT` markers
    22â†’- **Phase 3**: Note data format differences from LOIS conventions
    23â†’- **Phase 4**: Consolidate into LOIS_INTEGRATION.md guide
    24â†’
    25â†’This is a **quality gate** â€” phases don't ship until LOIS documentation is updated.
    26â†’
    27â†’## Phases
    28â†’
    29â†’**Phase Numbering:**
    30â†’
    31â†’- Integer phases (1, 2, 3): Planned milestone work
    32â†’- Decimal phases (2.1, 2.2): Urgent insertions (marked with INSERTED)
    33â†’
    34â†’- [x] **Phase 1: Backend Protocol** - Define message types, wire autopilot backend to serve all CLI data via WebSocket
    35â†’- [x] **Phase 2: Frontend Connection** - Add Vite proxy, connect widget to backend, display live data
    36â†’- [x] **Phase 3: Controls & P&L** - Implement commands, integrate NATS for real-time P&L calculation
    37â†’- [x] **Phase 4: Auto-Startup (Stretch)** - Auto-start autopilot backend alongside frontend dev server
    38â†’
    39â†’## Phase Details
    40â†’
    41â†’### Phase 1: Backend Protocol
    42â†’
    43â†’**Goal**: Complete WebSocket message protocol and wire autopilot backend to serve positions, signals, stats, config, and strategies
    44â†’**Depends on**: Nothing (first phase)
    45â†’**Research**: Unlikely (internal patterns, existing websocket-server.ts foundation)
    46â†’**LOIS Gate**: TriggerEvent and data types have LOIS compatibility comments
    47â†’**Plans**: TBD (likely 2-3 plans)
    48â†’
    49â†’Key work:
    50â†’
    51â†’- Define TypeScript message types for all backendâ†’frontend data
    52â†’- Wire autopilot's run loop to emit data over WebSocket
    53â†’- Implement command handlers for frontendâ†’backend messages
    54â†’- Add LOIS compatibility documentation to types
    55â†’
    56â†’### Phase 2: Frontend Connection
    57â†’
    58â†’**Goal**: Connect widget to autopilot backend and display live positions, signals, stats
    59â†’**Depends on**: Phase 1
    60â†’**Research**: Unlikely (existing BaseWebsocket and Zustand patterns)
    61â†’**LOIS Gate**: Integration points documented with markers
    62â†’**Plans**: TBD (likely 2 plans)
    63â†’
    64â†’Key work:
    65â†’
    66â†’- Add Vite proxy config for autopilot WebSocket (like local-api pattern)
    67â†’- Complete useAutopilotSubscription hook to parse messages and update store
    68â†’- Wire AutopilotWidget to display real data from store
    69â†’- Mark LOIS integration points in trigger.ts
    70â†’
    71â†’### Phase 3: Controls & P&L
    72â†’
    73â†’**Goal**: Full feature parity - all CLI controls work from widget, live P&L via NATS
    74â†’**Depends on**: Phase 2
    75â†’**Research**: Unlikely (existing NATS market_data subscription patterns)
    76â†’**LOIS Gate**: Data format notes explain LOIS convention differences
    77â†’**Plans**: TBD (likely 2-3 plans)
    78â†’
    79â†’Key work:
    80â†’
    81â†’- Implement all control commands (toggle strategies, sources, filter)
    82â†’- Subscribe to NATS market_data for open position mints
    83â†’- Calculate real-time unrealized P&L in frontend
    84â†’- Document data format differences from LOIS conventions
    85â†’
    86â†’### Phase 4: Auto-Startup (Stretch)
    87â†’
    88â†’**Goal**: Auto-start autopilot backend alongside frontend dev server
    89â†’**Depends on**: Phase 3
    90â†’**Research**: Likely (Vite plugin patterns, process management)
    91â†’**Research topics**: Vite plugin API, child process spawning, graceful shutdown
    92â†’**LOIS Gate**: Consolidate all LOIS docs into LOIS_INTEGRATION.md
    93â†’**Plans**: TBD (likely 1-2 plans)
    94â†’
    95â†’Key work:
    96â†’
    97â†’- Research Vite plugin or npm script approach
    98â†’- Implement auto-start mechanism
    99â†’- Handle graceful shutdown on dev server stop
   100â†’- Create LOIS_INTEGRATION.md guide for PUM3 team
   101â†’
   102â†’---
   103â†’
   104â†’### âœ… v1.1 Autopilot Unit Tests (Complete)
   105â†’
   106â†’**Milestone Goal:** Essential test coverage for the autopilot integration - P&L calculation, store slice, and message parsing
   107â†’
   108â†’#### Phase 5: Unit Tests
   109â†’
   110â†’**Goal**: Unit tests for P&L calculation hook, store slice, and WebSocket message parsing
   111â†’**Depends on**: Phase 4 (v1.0 complete)
   112â†’**Research**: Unlikely (Vitest already in project, internal patterns)
   113â†’**Plans**: 1/1 complete
   114â†’
   115â†’Key work:
   116â†’
   117â†’- P&L calculation tests: normal case, no market data, zero entry price edge case
   118â†’- Store slice tests: setPositions, addSignal (respects MAX_SIGNALS), reset
   119â†’- Message parsing tests: all event types, unknown events, malformed data handling
   120â†’
   121â†’Constraints:
   122â†’
   123â†’- Essential cases only (happy path + key edge cases)
   124â†’- No mocking WebSocket connections or NATS subscriptions
   125â†’- Tests should be fast and reliable
   126â†’
   127â†’Plans:
   128â†’
   129â†’- [x] 05-01: Unit tests (18 tests, 9min)
   130â†’
   131â†’## Progress
   132â†’
   133â†’**Execution Order:**
   134â†’Phases execute in numeric order: 1 â†’ 2 â†’ 3 â†’ 4 â†’ 5
   135â†’
   136â†’| Phase                     | Milestone | Plans Complete | Status   | Completed  |
   137â†’| ------------------------- | --------- | -------------- | -------- | ---------- |
   138â†’| 1. Backend Protocol       | v1.0      | 1/1            | Complete | 2026-01-08 |
   139â†’| 2. Frontend Connection    | v1.0      | 1/1            | Complete | 2026-01-08 |
   140â†’| 3. Controls & P&L         | v1.0      | 1/1            | Complete | 2026-01-08 |
   141â†’| 4. Auto-Startup (Stretch) | v1.0      | 1/1            | Complete | 2026-01-08 |
   142â†’| 5. Unit Tests             | v1.1      | 1/1            | Complete | 2026-01-08 |
   143â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
