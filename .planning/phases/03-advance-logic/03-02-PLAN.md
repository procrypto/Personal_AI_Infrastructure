---
phase: 03-advance-logic
plan: 02
type: execute
---

<objective>
Implement same-phase, phase-transition, and milestone-complete advancement logic in advance-work.md.

Purpose: Complete the core orchestration that enables automatic advancement within phases while preserving decision points at boundaries.
Output: Fully functional advance-work.md that handles all three advancement scenarios with mode-aware behavior.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase:
@.planning/phases/03-advance-logic/03-01-SUMMARY.md

# Key integration files:
@~/.claude/get-shit-done/workflows/advance-work.md
@~/.claude/get-shit-done/workflows/create-phase-summary.md
@~/.claude/get-shit-done/workflows/transition.md
@~/.claude/get-shit-done/templates/config.json

**Tech stack available:** config-driven behavior, 7-step-workflow-process
**Established patterns:** Mode-based behavior (yolo vs interactive), config.json auto_advance settings
**Constraining decisions:**
- same_phase: true by default (auto-advance within phase)
- phase_transition: false by default (prompt at boundaries)
- generate_phase_summary: true by default (automatic documentation)
- Milestone completion always prompts (safety rail)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement same-phase advancement</name>
  <files>~/.claude/get-shit-done/workflows/advance-work.md</files>
  <action>
Add step: handle_same_phase

Logic:
1. Read config.json auto_advance.same_phase setting (default: true)
2. Find next PLAN.md that doesn't have corresponding SUMMARY.md
3. Mode-aware behavior:

**If same_phase is true (or default):**
- YOLO mode: Auto-execute next plan immediately
  ```
  âš¡ Auto-advancing: {phase}-{next-plan}-PLAN.md
  ```
  Return: { action: "execute", plan_path: "path/to/next-plan" }

- Interactive mode: Show next plan info but wait for user
  ```
  Plan complete. Next: {phase}-{next-plan}

  /gsd:execute-plan {path}
  ```
  Return: { action: "prompt", next_plan: "path/to/next-plan" }

**If same_phase is false:**
- Always prompt regardless of mode
- Return: { action: "prompt", next_plan: "path/to/next-plan" }

Use behavior matrix pattern from config schema (Phase 1).
  </action>
  <verify>grep -A 20 "handle_same_phase" ~/.claude/get-shit-done/workflows/advance-work.md shows config check and mode-aware logic</verify>
  <done>Same-phase advancement respects auto_advance.same_phase setting and mode (yolo/interactive)</done>
</task>

<task type="auto">
  <name>Task 2: Implement phase-transition advancement</name>
  <files>~/.claude/get-shit-done/workflows/advance-work.md</files>
  <action>
Add step: handle_phase_complete

Logic:
1. Check config.json auto_advance.generate_phase_summary (default: true)
2. If true: Call create-phase-summary.md workflow
3. Read config.json auto_advance.phase_transition setting (default: false)
4. Mode-aware behavior:

**If phase_transition is true:**
- YOLO mode: Auto-invoke transition.md, then plan next phase
  ```
  âš¡ Phase complete. Auto-transitioning to Phase {X+1}
  ```
  Return: { action: "transition", next_phase: X+1 }

- Interactive mode: Show phase complete, prompt for transition
  ```
  Phase {X} complete!

  /gsd:plan-phase {X+1}
  ```
  Return: { action: "prompt_transition", next_phase: X+1 }

**If phase_transition is false (default):**
- Always prompt regardless of mode (this is the decision point)
- Return: { action: "prompt_transition", next_phase: X+1 }

Document the flow: advance-work.md â†’ create-phase-summary.md â†’ (user decision) â†’ transition.md
  </action>
  <verify>grep -A 20 "handle_phase_complete" ~/.claude/get-shit-done/workflows/advance-work.md shows create-phase-summary call and phase_transition config check</verify>
  <done>Phase-transition respects generate_phase_summary and phase_transition settings with mode-aware prompting</done>
</task>

<task type="auto">
  <name>Task 3: Implement milestone-complete handling</name>
  <files>~/.claude/get-shit-done/workflows/advance-work.md</files>
  <action>
Add step: handle_milestone_complete

Logic:
1. Generate phase summary (same as phase_complete)
2. **ALWAYS prompt regardless of config or mode** - This is a safety rail
3. Display milestone completion message:
   ```
   ðŸŽ‰ MILESTONE COMPLETE!

   All phases finished. Ready to archive.

   /gsd:complete-milestone
   ```
4. Return: { action: "milestone_complete" }

Add success_criteria section to workflow documenting all three scenarios are handled.

Document in error_handling: What happens if milestone detection fails (fall back to phase_complete behavior).
  </action>
  <verify>grep "milestone_complete\|ALWAYS prompt\|safety rail" ~/.claude/get-shit-done/workflows/advance-work.md confirms safety rail is documented</verify>
  <done>Milestone completion always prompts (safety rail enforced), proper celebration messaging</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All three scenarios implemented: same_phase, phase_complete, milestone_complete
- [ ] Config settings respected: same_phase, phase_transition, generate_phase_summary
- [ ] Mode-aware behavior: yolo auto-continues where allowed, interactive prompts
- [ ] Safety rail: milestone completion always prompts
- [ ] Integration documented: create-phase-summary.md called on phase completion
- [ ] success_criteria section added to workflow
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- advance-work.md fully functional
- Phase 3 complete - ready for Phase 4 (Command Interface)
</success_criteria>

<output>
After completion, create `.planning/phases/03-advance-logic/03-02-SUMMARY.md` following summary.md template with:
- Frontmatter with dependency graph (requires 03-01, provides advance-work-logic, affects execute-phase, transition)
- Performance metrics
- Task commits
- Files modified
- Key decisions about mode behavior and safety rails
- Next phase readiness for Phase 4

Since this is the last plan in Phase 3, also note "Phase 3 complete, ready for Phase 4: Command Interface"
</output>
