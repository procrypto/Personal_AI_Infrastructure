---
phase: 03-advance-logic
plan: 01
type: execute
---

<objective>
Create advance-work.md workflow structure with header sections, invocation patterns, and scenario detection logic.

Purpose: Establish the centralized advancement workflow that both manual (/gsd:advance) and automatic (execute-phase.md) triggers will call.
Output: ~/.claude/get-shit-done/workflows/advance-work.md with complete structure ready for logic implementation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (dependency graph):
@.planning/phases/01-config-schema/01-01-SUMMARY.md
@.planning/phases/02-phase-summary/02-02-SUMMARY.md

# Key files for integration patterns:
@~/.claude/get-shit-done/workflows/create-phase-summary.md
@~/.claude/get-shit-done/workflows/transition.md
@~/.claude/get-shit-done/workflows/execute-phase.md (lines 1568-1713 - offer_next step)

**Tech stack available:** config-driven behavior, 7-step-workflow-process
**Established patterns:** Behavior matrix for mode x settings combinations, integration_points documentation
**Constraining decisions:**
- Phase 1: same_phase: true by default, phase_transition: false by default
- Phase 2: Workflow called by advance-work.md when generate_phase_summary is true
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create advance-work.md with header sections</name>
  <files>~/.claude/get-shit-done/workflows/advance-work.md</files>
  <action>
Create advance-work.md with these sections (following create-phase-summary.md patterns):

1. **required_reading** - List files to read: STATE.md, config.json, current phase PLAN/SUMMARY files
2. **purpose** - Single source of truth for advancement logic; called by execute-phase.md offer_next and /gsd:advance command
3. **invocation** - Two entry points:
   - Automatic: Called by execute-phase.md after plan completion
   - Manual: /gsd:advance command
   - Parameters: current_plan_path (path to just-completed plan)
4. **integration_points** - Document the flow:
   - Entry: execute-phase.md offer_next OR /gsd:advance
   - Reads: STATE.md, config.json, phase directory
   - Calls: create-phase-summary.md (on phase complete), transition.md (on phase transition)
   - Outputs: Next action (execute next plan, prompt for phase transition, or milestone complete)
5. **error_handling** - Missing STATE.md, invalid plan path, config parse errors

Use the same XML step structure as create-phase-summary.md. Do NOT implement the logic steps yet - just placeholders.
  </action>
  <verify>File exists at ~/.claude/get-shit-done/workflows/advance-work.md with required_reading, purpose, invocation, integration_points, error_handling sections</verify>
  <done>advance-work.md created with all header sections, clear documentation of entry points and integration</done>
</task>

<task type="auto">
  <name>Task 2: Define scenario detection logic</name>
  <files>~/.claude/get-shit-done/workflows/advance-work.md</files>
  <action>
Add process section with scenario detection steps:

1. **step: load_context** - Read STATE.md, config.json, parse current position
2. **step: detect_scenario** - Determine which scenario applies:
   - Count PLAN files vs SUMMARY files in current phase directory
   - If SUMMARY_COUNT < PLAN_COUNT: scenario = "same_phase" (more plans to execute)
   - If SUMMARY_COUNT == PLAN_COUNT: Check if last phase in roadmap
     - If last phase: scenario = "milestone_complete"
     - If not last phase: scenario = "phase_complete"
3. **step: route_by_scenario** - Placeholder that routes to appropriate handler (to be implemented in 03-02)

Include bash commands for detection (similar to execute-phase.md offer_next logic). Document the three scenarios clearly with what each means and what should happen.
  </action>
  <verify>grep -c "same_phase\|phase_complete\|milestone_complete" ~/.claude/get-shit-done/workflows/advance-work.md returns at least 3 matches</verify>
  <done>Scenario detection logic defined with clear criteria for same_phase, phase_complete, and milestone_complete</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] advance-work.md exists in workflows directory
- [ ] All header sections present (required_reading, purpose, invocation, integration_points, error_handling)
- [ ] Scenario detection logic clearly documented
- [ ] Three scenarios defined: same_phase, phase_complete, milestone_complete
- [ ] Integration with execute-phase.md and transition.md documented
</verification>

<success_criteria>

- Both tasks completed
- All verification checks pass
- advance-work.md ready for logic implementation in 03-02
- Clear structure that 03-02 can build on
</success_criteria>

<output>
After completion, create `.planning/phases/03-advance-logic/03-01-SUMMARY.md` following summary.md template with:
- Frontmatter with dependency graph (requires 02-phase-summary, provides advance-work-structure, affects execute-phase)
- Performance metrics
- Task commits
- Files created
- Next phase readiness for 03-02
</output>
